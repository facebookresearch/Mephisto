<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 10.0.3"/>
    <title>mephisto.abstractions.providers.mturk.mturk_provider API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;}nav.pdoc{--pad:1.75rem;--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc li{display:block;margin:0;padding:.2rem 0 .2rem var(--indent);transition:all 100ms;}nav.pdoc > div > ul > li{padding-left:0;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc section{margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;cursor:pointer;}.pdoc details > summary:focus{outline:0;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc > section:first-of-type > .docstring{margin-bottom:2.5rem;}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../mturk.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;mephisto.abstractions.providers.mturk</a>

        <img src="https://mephisto.ai/img/logo.svg" class="logo" alt="project logo"/>
    <h3>Python API docs</h3>
    <p><small><a href="/docs/reference/overview">Return to all docs</a></small></p>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



        <h2>API Documentation</h2>
            <ul class="memberlist">
            <li>
                    <a class="class" href="#MTurkProviderArgs">MTurkProviderArgs</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MTurkProviderArgs.__init__">MTurkProviderArgs</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MTurkProvider">MTurkProvider</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#MTurkProvider.PROVIDER_TYPE">PROVIDER_TYPE</a>
                        </li>
                        <li>
                                <a class="class" href="#MTurkProvider.UnitClass">MTurkProvider.UnitClass</a>
                        </li>
                        <li>
                                <a class="class" href="#MTurkProvider.RequesterClass">MTurkProvider.RequesterClass</a>
                        </li>
                        <li>
                                <a class="class" href="#MTurkProvider.WorkerClass">MTurkProvider.WorkerClass</a>
                        </li>
                        <li>
                                <a class="class" href="#MTurkProvider.AgentClass">MTurkProvider.AgentClass</a>
                        </li>
                        <li>
                                <a class="class" href="#MTurkProvider.ArgsClass">MTurkProvider.ArgsClass</a>
                        </li>
                        <li>
                                <a class="function" href="#MTurkProvider.initialize_provider_datastore">initialize_provider_datastore</a>
                        </li>
                        <li>
                                <a class="function" href="#MTurkProvider.setup_resources_for_task_run">setup_resources_for_task_run</a>
                        </li>
                        <li>
                                <a class="function" href="#MTurkProvider.cleanup_resources_from_task_run">cleanup_resources_from_task_run</a>
                        </li>
                        <li>
                                <a class="function" href="#MTurkProvider.get_wrapper_js_path">get_wrapper_js_path</a>
                        </li>
                        <li>
                                <a class="function" href="#MTurkProvider.cleanup_qualification">cleanup_qualification</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section>
                    <h1 class="modulename">
<a href="./../../../../mephisto.html">mephisto</a><wbr>.<a href="./../../../abstractions.html">abstractions</a><wbr>.<a href="./../../providers.html">providers</a><wbr>.<a href="./../mturk.html">mturk</a><wbr>.mturk_provider    </h1>


                        <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>

<span class="c1"># Copyright (c) Facebook, Inc. and its affiliates.</span>
<span class="c1"># This source code is licensed under the MIT license found in the</span>
<span class="c1"># LICENSE file in the root directory of this source tree.</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">mephisto.abstractions.providers.mturk.provider_type</span> <span class="kn">import</span> <span class="n">PROVIDER_TYPE</span>
<span class="kn">from</span> <span class="nn">mephisto.abstractions.providers.mturk.mturk_datastore</span> <span class="kn">import</span> <span class="n">MTurkDatastore</span>
<span class="kn">from</span> <span class="nn">mephisto.abstractions.crowd_provider</span> <span class="kn">import</span> <span class="n">CrowdProvider</span><span class="p">,</span> <span class="n">ProviderArgs</span>
<span class="kn">from</span> <span class="nn">mephisto.data_model.requester</span> <span class="kn">import</span> <span class="n">RequesterArgs</span>
<span class="kn">from</span> <span class="nn">mephisto.abstractions.providers.mturk.mturk_agent</span> <span class="kn">import</span> <span class="n">MTurkAgent</span>
<span class="kn">from</span> <span class="nn">mephisto.abstractions.providers.mturk.mturk_requester</span> <span class="kn">import</span> <span class="n">MTurkRequester</span>
<span class="kn">from</span> <span class="nn">mephisto.abstractions.providers.mturk.mturk_unit</span> <span class="kn">import</span> <span class="n">MTurkUnit</span>
<span class="kn">from</span> <span class="nn">mephisto.abstractions.providers.mturk.mturk_worker</span> <span class="kn">import</span> <span class="n">MTurkWorker</span>
<span class="kn">from</span> <span class="nn">mephisto.abstractions.providers.mturk.mturk_utils</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">create_hit_type</span><span class="p">,</span>
    <span class="n">create_hit_config</span><span class="p">,</span>
    <span class="n">delete_qualification</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">mephisto.operations.registry</span> <span class="kn">import</span> <span class="n">register_mephisto_abstraction</span>
<span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span><span class="p">,</span> <span class="n">field</span>

<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">ClassVar</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Type</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">cast</span><span class="p">,</span> <span class="n">TYPE_CHECKING</span>

<span class="kn">from</span> <span class="nn">mephisto.data_model.requester</span> <span class="kn">import</span> <span class="n">Requester</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">mephisto.abstractions.blueprint</span> <span class="kn">import</span> <span class="n">SharedTaskState</span>
    <span class="kn">from</span> <span class="nn">mephisto.data_model.task_run</span> <span class="kn">import</span> <span class="n">TaskRun</span>
    <span class="kn">from</span> <span class="nn">mephisto.data_model.unit</span> <span class="kn">import</span> <span class="n">Unit</span>
    <span class="kn">from</span> <span class="nn">mephisto.data_model.worker</span> <span class="kn">import</span> <span class="n">Worker</span>
    <span class="kn">from</span> <span class="nn">mephisto.data_model.agent</span> <span class="kn">import</span> <span class="n">Agent</span>
    <span class="kn">from</span> <span class="nn">omegaconf</span> <span class="kn">import</span> <span class="n">DictConfig</span>


<span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">MTurkProviderArgs</span><span class="p">(</span><span class="n">ProviderArgs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Provider args for an MTurk provider&quot;&quot;&quot;</span>

    <span class="n">_provider_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">PROVIDER_TYPE</span>


<span class="nd">@register_mephisto_abstraction</span><span class="p">()</span>
<span class="k">class</span> <span class="nc">MTurkProvider</span><span class="p">(</span><span class="n">CrowdProvider</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of a crowdprovider that interfaces with MTurk</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Ensure inherited methods use this level&#39;s provider type</span>
    <span class="n">PROVIDER_TYPE</span> <span class="o">=</span> <span class="n">PROVIDER_TYPE</span>

    <span class="n">UnitClass</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Unit&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MTurkUnit</span>

    <span class="n">RequesterClass</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Requester&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MTurkRequester</span>

    <span class="n">WorkerClass</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Worker&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MTurkWorker</span>

    <span class="n">AgentClass</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Agent&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MTurkAgent</span>

    <span class="n">ArgsClass</span> <span class="o">=</span> <span class="n">MTurkProviderArgs</span>

    <span class="k">def</span> <span class="nf">initialize_provider_datastore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MTurk itself is the source of truth for most data required to run</span>
<span class="sd">        tasks on MTurk. The datastore holds sessions to connect with</span>
<span class="sd">        MTurk as well as mappings between MTurk ids and Mephisto ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MTurkDatastore</span><span class="p">(</span><span class="n">datastore_root</span><span class="o">=</span><span class="n">storage_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requester_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an mturk client for usage with mturk_utils</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_client_for_requester</span><span class="p">(</span><span class="n">requester_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup_resources_for_task_run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">task_run</span><span class="p">:</span> <span class="s2">&quot;TaskRun&quot;</span><span class="p">,</span>
        <span class="n">args</span><span class="p">:</span> <span class="s2">&quot;DictConfig&quot;</span><span class="p">,</span>
        <span class="n">shared_state</span><span class="p">:</span> <span class="s2">&quot;SharedTaskState&quot;</span><span class="p">,</span>
        <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Produce the HIT type for this task run.&quot;&quot;&quot;</span>
        <span class="n">requester</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;MTurkRequester&quot;</span><span class="p">,</span> <span class="n">task_run</span><span class="o">.</span><span class="n">get_requester</span><span class="p">())</span>
        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_session_for_requester</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">task_run_id</span> <span class="o">=</span> <span class="n">task_run</span><span class="o">.</span><span class="n">db_id</span>

        <span class="c1"># Set up HIT config</span>
        <span class="n">config_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">datastore_root</span><span class="p">,</span> <span class="n">task_run_id</span><span class="p">)</span>
        <span class="n">task_args</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">task</span>

        <span class="c1"># Find or create relevant qualifications</span>
        <span class="n">qualifications</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">qualification</span> <span class="ow">in</span> <span class="n">shared_state</span><span class="o">.</span><span class="n">qualifications</span><span class="p">:</span>
            <span class="n">applicable_providers</span> <span class="o">=</span> <span class="n">qualification</span><span class="p">[</span><span class="s2">&quot;applicable_providers&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">applicable_providers</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">PROVIDER_TYPE</span> <span class="ow">in</span> <span class="n">applicable_providers</span>
            <span class="p">):</span>
                <span class="n">qualifications</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qualification</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">qualification</span> <span class="ow">in</span> <span class="n">qualifications</span><span class="p">:</span>
            <span class="n">qualification_name</span> <span class="o">=</span> <span class="n">qualification</span><span class="p">[</span><span class="s2">&quot;qualification_name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">requester</span><span class="o">.</span><span class="n">PROVIDER_TYPE</span> <span class="o">==</span> <span class="s2">&quot;mturk_sandbox&quot;</span><span class="p">:</span>
                <span class="n">qualification_name</span> <span class="o">+=</span> <span class="s2">&quot;_sandbox&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_qualification_mapping</span><span class="p">(</span><span class="n">qualification_name</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">qualification</span><span class="p">[</span>
                    <span class="s2">&quot;QualificationTypeId&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">requester</span><span class="o">.</span><span class="n">_create_new_mturk_qualification</span><span class="p">(</span><span class="n">qualification_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">shared_state</span><span class="p">,</span> <span class="s2">&quot;mturk_specific_qualifications&quot;</span><span class="p">):</span>
            <span class="c1"># TODO(OWN) standardize provider-specific qualifications</span>
            <span class="n">qualifications</span> <span class="o">+=</span> <span class="n">shared_state</span><span class="o">.</span><span class="n">mturk_specific_qualifications</span>  <span class="c1"># type: ignore</span>

        <span class="c1"># Set up HIT type</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">hit_type_id</span> <span class="o">=</span> <span class="n">create_hit_type</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">task_args</span><span class="p">,</span> <span class="n">qualifications</span><span class="p">)</span>
        <span class="n">frame_height</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">task_run</span><span class="o">.</span><span class="n">get_blueprint</span><span class="p">()</span><span class="o">.</span><span class="n">get_frontend_args</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frame_height&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">register_run</span><span class="p">(</span><span class="n">task_run_id</span><span class="p">,</span> <span class="n">hit_type_id</span><span class="p">,</span> <span class="n">config_dir</span><span class="p">,</span> <span class="n">frame_height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cleanup_resources_from_task_run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">task_run</span><span class="p">:</span> <span class="s2">&quot;TaskRun&quot;</span><span class="p">,</span> <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;No cleanup necessary for task type&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_wrapper_js_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the path to the `wrap_crowd_source.js` file for this</span>
<span class="sd">        provider to be deployed to the server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;wrap_crowd_source.js&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cleanup_qualification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qualification_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Remove the qualification from the sandbox server, if it exists&quot;&quot;&quot;</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_qualification_mapping</span><span class="p">(</span><span class="n">qualification_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">requester_id</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;requester_id&quot;</span><span class="p">]</span>
        <span class="n">requester</span> <span class="o">=</span> <span class="n">Requester</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">requester_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">requester</span><span class="p">,</span> <span class="n">MTurkRequester</span><span class="p">),</span> <span class="s2">&quot;Must be an mturk requester&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">requester</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">delete_qualification</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;mturk_qualification_id&quot;</span><span class="p">])</span>
</pre></div>

        </details>

            </section>
                <section id="MTurkProviderArgs">
                                <div class="attr class">
        <a class="headerlink" href="#MTurkProviderArgs">#&nbsp;&nbsp</a>


        <span class="def">class</span>
        <span class="name">MTurkProviderArgs</span><wbr>(<span class="base"><a href="../../crowd_provider.html#ProviderArgs">mephisto.abstractions.crowd_provider.ProviderArgs</a></span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MTurkProviderArgs</span><span class="p">(</span><span class="n">ProviderArgs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Provider args for an MTurk provider&quot;&quot;&quot;</span>

    <span class="n">_provider_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">PROVIDER_TYPE</span>
</pre></div>

        </details>

            <div class="docstring"><p>Provider args for an MTurk provider</p>
</div>


                            <div id="MTurkProviderArgs.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MTurkProviderArgs.__init__">#&nbsp;&nbsp</a>


            <span class="name">MTurkProviderArgs</span><span class="signature">(_provider_type: str = &#39;mturk&#39;, requester_name: str = &#39;???&#39;)</span>
    </div>




                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="../../crowd_provider.html#ProviderArgs">mephisto.abstractions.crowd_provider.ProviderArgs</a></dt>
                                <dd id="MTurkProviderArgs.requester_name" class="variable"><a href="../../crowd_provider.html#ProviderArgs.requester_name">requester_name</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MTurkProvider">
                                <div class="attr class">
        <a class="headerlink" href="#MTurkProvider">#&nbsp;&nbsp</a>


        <span class="def">class</span>
        <span class="name">MTurkProvider</span><wbr>(<span class="base"><a href="../../crowd_provider.html#CrowdProvider">mephisto.abstractions.crowd_provider.CrowdProvider</a></span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MTurkProvider</span><span class="p">(</span><span class="n">CrowdProvider</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implementation of a crowdprovider that interfaces with MTurk</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Ensure inherited methods use this level&#39;s provider type</span>
    <span class="n">PROVIDER_TYPE</span> <span class="o">=</span> <span class="n">PROVIDER_TYPE</span>

    <span class="n">UnitClass</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Unit&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MTurkUnit</span>

    <span class="n">RequesterClass</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Requester&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MTurkRequester</span>

    <span class="n">WorkerClass</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Worker&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MTurkWorker</span>

    <span class="n">AgentClass</span><span class="p">:</span> <span class="n">ClassVar</span><span class="p">[</span><span class="n">Type</span><span class="p">[</span><span class="s2">&quot;Agent&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">MTurkAgent</span>

    <span class="n">ArgsClass</span> <span class="o">=</span> <span class="n">MTurkProviderArgs</span>

    <span class="k">def</span> <span class="nf">initialize_provider_datastore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MTurk itself is the source of truth for most data required to run</span>
<span class="sd">        tasks on MTurk. The datastore holds sessions to connect with</span>
<span class="sd">        MTurk as well as mappings between MTurk ids and Mephisto ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MTurkDatastore</span><span class="p">(</span><span class="n">datastore_root</span><span class="o">=</span><span class="n">storage_path</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_get_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requester_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an mturk client for usage with mturk_utils</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_client_for_requester</span><span class="p">(</span><span class="n">requester_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setup_resources_for_task_run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">task_run</span><span class="p">:</span> <span class="s2">&quot;TaskRun&quot;</span><span class="p">,</span>
        <span class="n">args</span><span class="p">:</span> <span class="s2">&quot;DictConfig&quot;</span><span class="p">,</span>
        <span class="n">shared_state</span><span class="p">:</span> <span class="s2">&quot;SharedTaskState&quot;</span><span class="p">,</span>
        <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Produce the HIT type for this task run.&quot;&quot;&quot;</span>
        <span class="n">requester</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;MTurkRequester&quot;</span><span class="p">,</span> <span class="n">task_run</span><span class="o">.</span><span class="n">get_requester</span><span class="p">())</span>
        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_session_for_requester</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">task_run_id</span> <span class="o">=</span> <span class="n">task_run</span><span class="o">.</span><span class="n">db_id</span>

        <span class="c1"># Set up HIT config</span>
        <span class="n">config_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">datastore_root</span><span class="p">,</span> <span class="n">task_run_id</span><span class="p">)</span>
        <span class="n">task_args</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">task</span>

        <span class="c1"># Find or create relevant qualifications</span>
        <span class="n">qualifications</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">qualification</span> <span class="ow">in</span> <span class="n">shared_state</span><span class="o">.</span><span class="n">qualifications</span><span class="p">:</span>
            <span class="n">applicable_providers</span> <span class="o">=</span> <span class="n">qualification</span><span class="p">[</span><span class="s2">&quot;applicable_providers&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">applicable_providers</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">PROVIDER_TYPE</span> <span class="ow">in</span> <span class="n">applicable_providers</span>
            <span class="p">):</span>
                <span class="n">qualifications</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qualification</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">qualification</span> <span class="ow">in</span> <span class="n">qualifications</span><span class="p">:</span>
            <span class="n">qualification_name</span> <span class="o">=</span> <span class="n">qualification</span><span class="p">[</span><span class="s2">&quot;qualification_name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">requester</span><span class="o">.</span><span class="n">PROVIDER_TYPE</span> <span class="o">==</span> <span class="s2">&quot;mturk_sandbox&quot;</span><span class="p">:</span>
                <span class="n">qualification_name</span> <span class="o">+=</span> <span class="s2">&quot;_sandbox&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_qualification_mapping</span><span class="p">(</span><span class="n">qualification_name</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">qualification</span><span class="p">[</span>
                    <span class="s2">&quot;QualificationTypeId&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">requester</span><span class="o">.</span><span class="n">_create_new_mturk_qualification</span><span class="p">(</span><span class="n">qualification_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">shared_state</span><span class="p">,</span> <span class="s2">&quot;mturk_specific_qualifications&quot;</span><span class="p">):</span>
            <span class="c1"># TODO(OWN) standardize provider-specific qualifications</span>
            <span class="n">qualifications</span> <span class="o">+=</span> <span class="n">shared_state</span><span class="o">.</span><span class="n">mturk_specific_qualifications</span>  <span class="c1"># type: ignore</span>

        <span class="c1"># Set up HIT type</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">hit_type_id</span> <span class="o">=</span> <span class="n">create_hit_type</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">task_args</span><span class="p">,</span> <span class="n">qualifications</span><span class="p">)</span>
        <span class="n">frame_height</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">task_run</span><span class="o">.</span><span class="n">get_blueprint</span><span class="p">()</span><span class="o">.</span><span class="n">get_frontend_args</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frame_height&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">register_run</span><span class="p">(</span><span class="n">task_run_id</span><span class="p">,</span> <span class="n">hit_type_id</span><span class="p">,</span> <span class="n">config_dir</span><span class="p">,</span> <span class="n">frame_height</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cleanup_resources_from_task_run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">task_run</span><span class="p">:</span> <span class="s2">&quot;TaskRun&quot;</span><span class="p">,</span> <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;No cleanup necessary for task type&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_wrapper_js_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the path to the `wrap_crowd_source.js` file for this</span>
<span class="sd">        provider to be deployed to the server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;wrap_crowd_source.js&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">cleanup_qualification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qualification_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Remove the qualification from the sandbox server, if it exists&quot;&quot;&quot;</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_qualification_mapping</span><span class="p">(</span><span class="n">qualification_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">requester_id</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;requester_id&quot;</span><span class="p">]</span>
        <span class="n">requester</span> <span class="o">=</span> <span class="n">Requester</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">requester_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">requester</span><span class="p">,</span> <span class="n">MTurkRequester</span><span class="p">),</span> <span class="s2">&quot;Must be an mturk requester&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">requester</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">delete_qualification</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;mturk_qualification_id&quot;</span><span class="p">])</span>
</pre></div>

        </details>

            <div class="docstring"><p>Implementation of a crowdprovider that interfaces with MTurk</p>
</div>


                            <div id="MTurkProvider.PROVIDER_TYPE" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#MTurkProvider.PROVIDER_TYPE">#&nbsp;&nbsp</a>

        <span class="name">PROVIDER_TYPE</span><span class="default_value"> = &#39;mturk&#39;</span>
    </div>




                            </div>
                            <div id="MTurkProvider.initialize_provider_datastore" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MTurkProvider.initialize_provider_datastore">#&nbsp;&nbsp</a>


            <span class="def">def</span>
            <span class="name">initialize_provider_datastore</span><span class="signature">(self, storage_path: str) -&gt; Any</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">initialize_provider_datastore</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MTurk itself is the source of truth for most data required to run</span>
<span class="sd">        tasks on MTurk. The datastore holds sessions to connect with</span>
<span class="sd">        MTurk as well as mappings between MTurk ids and Mephisto ids</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MTurkDatastore</span><span class="p">(</span><span class="n">datastore_root</span><span class="o">=</span><span class="n">storage_path</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>MTurk itself is the source of truth for most data required to run
tasks on MTurk. The datastore holds sessions to connect with
MTurk as well as mappings between MTurk ids and Mephisto ids</p>
</div>


                            </div>
                            <div id="MTurkProvider.setup_resources_for_task_run" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MTurkProvider.setup_resources_for_task_run">#&nbsp;&nbsp</a>


            <span class="def">def</span>
            <span class="name">setup_resources_for_task_run</span><span class="signature">(
    self,
    task_run: <a href="../../../data_model/task_run.html#TaskRun">mephisto.data_model.task_run.TaskRun</a>,
    args: omegaconf.dictconfig.DictConfig,
    shared_state: <a href="../../blueprint.html#SharedTaskState">mephisto.abstractions.blueprint.SharedTaskState</a>,
    server_url: str
) -&gt; None</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">setup_resources_for_task_run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">task_run</span><span class="p">:</span> <span class="s2">&quot;TaskRun&quot;</span><span class="p">,</span>
        <span class="n">args</span><span class="p">:</span> <span class="s2">&quot;DictConfig&quot;</span><span class="p">,</span>
        <span class="n">shared_state</span><span class="p">:</span> <span class="s2">&quot;SharedTaskState&quot;</span><span class="p">,</span>
        <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Produce the HIT type for this task run.&quot;&quot;&quot;</span>
        <span class="n">requester</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;MTurkRequester&quot;</span><span class="p">,</span> <span class="n">task_run</span><span class="o">.</span><span class="n">get_requester</span><span class="p">())</span>
        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_session_for_requester</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">task_run_id</span> <span class="o">=</span> <span class="n">task_run</span><span class="o">.</span><span class="n">db_id</span>

        <span class="c1"># Set up HIT config</span>
        <span class="n">config_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">datastore_root</span><span class="p">,</span> <span class="n">task_run_id</span><span class="p">)</span>
        <span class="n">task_args</span> <span class="o">=</span> <span class="n">args</span><span class="o">.</span><span class="n">task</span>

        <span class="c1"># Find or create relevant qualifications</span>
        <span class="n">qualifications</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">qualification</span> <span class="ow">in</span> <span class="n">shared_state</span><span class="o">.</span><span class="n">qualifications</span><span class="p">:</span>
            <span class="n">applicable_providers</span> <span class="o">=</span> <span class="n">qualification</span><span class="p">[</span><span class="s2">&quot;applicable_providers&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="p">(</span>
                <span class="n">applicable_providers</span> <span class="ow">is</span> <span class="kc">None</span>
                <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">PROVIDER_TYPE</span> <span class="ow">in</span> <span class="n">applicable_providers</span>
            <span class="p">):</span>
                <span class="n">qualifications</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">qualification</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">qualification</span> <span class="ow">in</span> <span class="n">qualifications</span><span class="p">:</span>
            <span class="n">qualification_name</span> <span class="o">=</span> <span class="n">qualification</span><span class="p">[</span><span class="s2">&quot;qualification_name&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">requester</span><span class="o">.</span><span class="n">PROVIDER_TYPE</span> <span class="o">==</span> <span class="s2">&quot;mturk_sandbox&quot;</span><span class="p">:</span>
                <span class="n">qualification_name</span> <span class="o">+=</span> <span class="s2">&quot;_sandbox&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_qualification_mapping</span><span class="p">(</span><span class="n">qualification_name</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">qualification</span><span class="p">[</span>
                    <span class="s2">&quot;QualificationTypeId&quot;</span>
                <span class="p">]</span> <span class="o">=</span> <span class="n">requester</span><span class="o">.</span><span class="n">_create_new_mturk_qualification</span><span class="p">(</span><span class="n">qualification_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">shared_state</span><span class="p">,</span> <span class="s2">&quot;mturk_specific_qualifications&quot;</span><span class="p">):</span>
            <span class="c1"># TODO(OWN) standardize provider-specific qualifications</span>
            <span class="n">qualifications</span> <span class="o">+=</span> <span class="n">shared_state</span><span class="o">.</span><span class="n">mturk_specific_qualifications</span>  <span class="c1"># type: ignore</span>

        <span class="c1"># Set up HIT type</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">hit_type_id</span> <span class="o">=</span> <span class="n">create_hit_type</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">task_args</span><span class="p">,</span> <span class="n">qualifications</span><span class="p">)</span>
        <span class="n">frame_height</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">task_run</span><span class="o">.</span><span class="n">get_blueprint</span><span class="p">()</span><span class="o">.</span><span class="n">get_frontend_args</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;frame_height&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">register_run</span><span class="p">(</span><span class="n">task_run_id</span><span class="p">,</span> <span class="n">hit_type_id</span><span class="p">,</span> <span class="n">config_dir</span><span class="p">,</span> <span class="n">frame_height</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Produce the HIT type for this task run.</p>
</div>


                            </div>
                            <div id="MTurkProvider.cleanup_resources_from_task_run" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MTurkProvider.cleanup_resources_from_task_run">#&nbsp;&nbsp</a>


            <span class="def">def</span>
            <span class="name">cleanup_resources_from_task_run</span><span class="signature">(
    self,
    task_run: <a href="../../../data_model/task_run.html#TaskRun">mephisto.data_model.task_run.TaskRun</a>,
    server_url: str
) -&gt; None</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">cleanup_resources_from_task_run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">task_run</span><span class="p">:</span> <span class="s2">&quot;TaskRun&quot;</span><span class="p">,</span> <span class="n">server_url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;No cleanup necessary for task type&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</pre></div>

        </details>

            <div class="docstring"><p>No cleanup necessary for task type</p>
</div>


                            </div>
                            <div id="MTurkProvider.get_wrapper_js_path" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MTurkProvider.get_wrapper_js_path">#&nbsp;&nbsp</a>

                <div class="decorator">@classmethod</div>

            <span class="def">def</span>
            <span class="name">get_wrapper_js_path</span><span class="signature">(cls)</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_wrapper_js_path</span><span class="p">(</span><span class="bp">cls</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the path to the `wrap_crowd_source.js` file for this</span>
<span class="sd">        provider to be deployed to the server</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="vm">__file__</span><span class="p">),</span> <span class="s2">&quot;wrap_crowd_source.js&quot;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return the path to the <code>wrap_crowd_source.js</code> file for this
provider to be deployed to the server</p>
</div>


                            </div>
                            <div id="MTurkProvider.cleanup_qualification" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#MTurkProvider.cleanup_qualification">#&nbsp;&nbsp</a>


            <span class="def">def</span>
            <span class="name">cleanup_qualification</span><span class="signature">(self, qualification_name: str) -&gt; None</span>:
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span>    <span class="k">def</span> <span class="nf">cleanup_qualification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qualification_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Remove the qualification from the sandbox server, if it exists&quot;&quot;&quot;</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_qualification_mapping</span><span class="p">(</span><span class="n">qualification_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mapping</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">requester_id</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;requester_id&quot;</span><span class="p">]</span>
        <span class="n">requester</span> <span class="o">=</span> <span class="n">Requester</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">requester_id</span><span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">requester</span><span class="p">,</span> <span class="n">MTurkRequester</span><span class="p">),</span> <span class="s2">&quot;Must be an mturk requester&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="n">requester</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">delete_qualification</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;mturk_qualification_id&quot;</span><span class="p">])</span>
</pre></div>

        </details>

            <div class="docstring"><p>Remove the qualification from the sandbox server, if it exists</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="../../crowd_provider.html#CrowdProvider">mephisto.abstractions.crowd_provider.CrowdProvider</a></dt>
                                <dd id="MTurkProvider.__init__" class="function"><a href="../../crowd_provider.html#CrowdProvider.__init__">CrowdProvider</a></dd>
                <dd id="MTurkProvider.is_sandbox" class="function"><a href="../../crowd_provider.html#CrowdProvider.is_sandbox">is_sandbox</a></dd>
                <dd id="MTurkProvider.assert_task_args" class="function"><a href="../../crowd_provider.html#CrowdProvider.assert_task_args">assert_task_args</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MTurkProvider.UnitClass">
                                <div class="attr class">
        <a class="headerlink" href="#MTurkProvider.UnitClass">#&nbsp;&nbsp</a>


        <span class="def">class</span>
        <span class="name">MTurkProvider.UnitClass</span><wbr>(<span class="base"><a href="../../../data_model/unit.html#Unit">mephisto.data_model.unit.Unit</a></span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MTurkUnit</span><span class="p">(</span><span class="n">Unit</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class tracks the status of an individual worker&#39;s contribution to a</span>
<span class="sd">    higher level assignment. It is the smallest &#39;unit&#39; of work to complete</span>
<span class="sd">    the assignment, and this class is only responsible for checking</span>
<span class="sd">    the status of that work itself being done.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Ensure inherited methods use this level&#39;s provider type</span>
    <span class="n">PROVIDER_TYPE</span> <span class="o">=</span> <span class="n">PROVIDER_TYPE</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">db</span><span class="p">:</span> <span class="s2">&quot;MephistoDB&quot;</span><span class="p">,</span>
        <span class="n">db_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">row</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_used_new_call</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">db_id</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">_used_new_call</span><span class="o">=</span><span class="n">_used_new_call</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="p">:</span> <span class="s2">&quot;MTurkDatastore&quot;</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_datastore_for_provider</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PROVIDER_TYPE</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">hit_id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_sync_time</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_hit_mapping</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__requester</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;MTurkRequester&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_get_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requester_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an mturk client for usage with mturk_utils</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_client_for_requester</span><span class="p">(</span><span class="n">requester_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_sync_hit_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Sync with the datastore to see if any mappings have updated&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">is_hit_mapping_in_sync</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_last_sync_time</span><span class="p">):</span>
            <span class="k">return</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_hit_mapping</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_id</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hit_id</span> <span class="o">=</span> <span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;hit_id&quot;</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mturk_assignment_id</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;assignment_id&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assignment_time_in_seconds</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;assignment_time_in_seconds&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
            <span class="c1"># HIT does not appear to exist</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">hit_id</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mturk_assignment_id</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">assignment_time_in_seconds</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="c1"># We update to a time slightly earlier than now, in order</span>
        <span class="c1"># to reduce the risk of a race condition caching an old</span>
        <span class="c1"># value the moment it&#39;s registered</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_last_sync_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">monotonic</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">register_from_provider_data</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">hit_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">mturk_assignment_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Update the datastore and local information from this registration&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">register_assignment_to_hit</span><span class="p">(</span>
            <span class="n">hit_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_id</span><span class="p">,</span> <span class="n">mturk_assignment_id</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_hit_mapping</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">get_mturk_assignment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the MTurk assignment id associated with this unit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_hit_mapping</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mturk_assignment_id</span>

    <span class="k">def</span> <span class="nf">get_mturk_hit_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Return the MTurk hit id associated with this unit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sync_hit_mapping</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">hit_id</span>

    <span class="k">def</span> <span class="nf">get_requester</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;MTurkRequester&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Wrapper around regular Requester as this will be MTurkRequesters&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__requester</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__requester</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;MTurkRequester&quot;</span><span class="p">,</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_requester</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__requester</span>

    <span class="k">def</span> <span class="nf">set_db_status</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the status reflected in the database for this Unit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">set_db_status</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">:</span>
            <span class="n">agent</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;MTurkAgent&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_assigned_agent</span><span class="p">())</span>
            <span class="k">if</span> <span class="n">agent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">agent_status</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">agent_status</span> <span class="o">==</span> <span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_IN_TASK</span><span class="p">:</span>
                    <span class="c1"># Oh no, MTurk has completed the unit, but we don&#39;t have</span>
                    <span class="c1"># the data. We need to reconcile</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Unit </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> moved to completed, but the agent didn&#39;t... &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;Attempting to reconcile with MTurk directly&quot;</span>
                    <span class="p">)</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="n">hit_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mturk_hit_id</span><span class="p">()</span>
                        <span class="k">assert</span> <span class="p">(</span>
                            <span class="n">hit_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                        <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;This unit does not have an ID! </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">&quot;</span>

                        <span class="n">agent</span><span class="o">.</span><span class="n">attempt_to_reconcile_submitted_data</span><span class="p">(</span><span class="n">hit_id</span><span class="p">)</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Was not able to reconcile due to an error, </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">. &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;You may need to reconcile this specific Agent manually &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;after the task is completed. See here for details: &quot;</span>
                            <span class="sa">f</span><span class="s2">&quot;https://github.com/facebookresearch/Mephisto/pull/442&quot;</span>
                        <span class="p">)</span>
                <span class="k">elif</span> <span class="n">agent_status</span> <span class="o">==</span> <span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_TIMEOUT</span><span class="p">:</span>
                    <span class="c1"># Oh no, this is also bad. we shouldn&#39;t be completing for a timed out agent.</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Found a timeout that&#39;s trying to be pushed to completed with a timed out agent&quot;</span>
                    <span class="p">)</span>
                    <span class="k">pass</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No agent found for completed unit </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clear_assigned_agent</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Additionally to clearing the agent, we also need to dissociate the</span>
<span class="sd">        hit_id from this unit in the MTurkDatastore</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_status</span> <span class="o">==</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Clearing an agent when COMPLETED, it&#39;s likely a submit happened &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;but could not be received by the Mephisto backend. This &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;assignment clear is thus being ignored, but this message &quot;</span>
                <span class="sa">f</span><span class="s2">&quot;is indicative of some data loss. &quot;</span>
            <span class="p">)</span>
            <span class="c1"># TODO(OWN) how can we reconcile missing data here? Marking this agent as</span>
            <span class="c1"># COMPLETED will pollute the data, but not marking it means that</span>
            <span class="c1"># it will have to be the auto-approve deadline.</span>
            <span class="k">return</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">clear_assigned_agent</span><span class="p">()</span>
        <span class="n">mturk_hit_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mturk_hit_id</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mturk_hit_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">clear_hit_from_unit</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_sync_hit_mapping</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_status</span> <span class="o">==</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">ASSIGNED</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_db_status</span><span class="p">(</span><span class="n">AssignmentState</span><span class="o">.</span><span class="n">LAUNCHED</span><span class="p">)</span>

    <span class="c1"># Required Unit functions</span>

    <span class="k">def</span> <span class="nf">get_status</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get status for this unit directly from MTurk, fall back on local info&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_status</span> <span class="o">==</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">CREATED</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_status</span> <span class="ow">in</span> <span class="p">[</span>
            <span class="n">AssignmentState</span><span class="o">.</span><span class="n">ACCEPTED</span><span class="p">,</span>
            <span class="n">AssignmentState</span><span class="o">.</span><span class="n">EXPIRED</span><span class="p">,</span>
            <span class="n">AssignmentState</span><span class="o">.</span><span class="n">SOFT_REJECTED</span><span class="p">,</span>
        <span class="p">]:</span>
            <span class="c1"># These statuses don&#39;t change with a get_status call</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_status</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">AssignmentState</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">,</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">REJECTED</span><span class="p">]:</span>
            <span class="c1"># These statuses only change on agent dependent changes</span>
            <span class="n">agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_assigned_agent</span><span class="p">()</span>
            <span class="n">found_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_status</span>
            <span class="k">if</span> <span class="n">agent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">agent_status</span> <span class="o">=</span> <span class="n">agent</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">agent_status</span> <span class="o">==</span> <span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_APPROVED</span><span class="p">:</span>
                    <span class="n">found_status</span> <span class="o">=</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">ACCEPTED</span>
                <span class="k">elif</span> <span class="n">agent_status</span> <span class="o">==</span> <span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_REJECTED</span><span class="p">:</span>
                    <span class="n">found_status</span> <span class="o">=</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">REJECTED</span>
                <span class="k">elif</span> <span class="n">agent_status</span> <span class="o">==</span> <span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_SOFT_REJECTED</span><span class="p">:</span>
                    <span class="n">found_status</span> <span class="o">=</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">SOFT_REJECTED</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Agent for unit </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2"> is None&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">found_status</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_status</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_db_status</span><span class="p">(</span><span class="n">found_status</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_status</span>

        <span class="c1"># Remaining statuses are tracking a live HIT</span>

        <span class="n">mturk_hit_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mturk_hit_id</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">mturk_hit_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If the hit_id is None and there&#39;s an agent still assigned,</span>
            <span class="c1"># then that agent has timed out and we should expire</span>
            <span class="n">agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_assigned_agent</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">agent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">agent</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span> <span class="o">!=</span> <span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_EXPIRED</span><span class="p">:</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_EXPIRED</span><span class="p">)</span>

            <span class="c1"># Can&#39;t determine anything else if there is no HIT on this unit</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_status</span>

        <span class="n">requester</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_requester</span><span class="p">()</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">hit</span> <span class="o">=</span> <span class="n">get_hit</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">mturk_hit_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">hit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">EXPIRED</span>
        <span class="n">hit_data</span> <span class="o">=</span> <span class="n">hit</span><span class="p">[</span><span class="s2">&quot;HIT&quot;</span><span class="p">]</span>

        <span class="n">local_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_status</span>
        <span class="n">external_status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_status</span>

        <span class="k">if</span> <span class="n">hit_data</span><span class="p">[</span><span class="s2">&quot;HITStatus&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Assignable&quot;</span><span class="p">:</span>
            <span class="n">external_status</span> <span class="o">=</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">LAUNCHED</span>
        <span class="k">elif</span> <span class="n">hit_data</span><span class="p">[</span><span class="s2">&quot;HITStatus&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Unassignable&quot;</span><span class="p">:</span>
            <span class="n">external_status</span> <span class="o">=</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">ASSIGNED</span>
        <span class="k">elif</span> <span class="n">hit_data</span><span class="p">[</span><span class="s2">&quot;HITStatus&quot;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Reviewable&quot;</span><span class="p">,</span> <span class="s2">&quot;Reviewing&quot;</span><span class="p">]:</span>
            <span class="n">external_status</span> <span class="o">=</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">COMPLETED</span>
            <span class="k">if</span> <span class="n">hit_data</span><span class="p">[</span><span class="s2">&quot;NumberOfAssignmentsAvailable&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">external_status</span> <span class="o">=</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">EXPIRED</span>
        <span class="k">elif</span> <span class="n">hit_data</span><span class="p">[</span><span class="s2">&quot;HITStatus&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Disposed&quot;</span><span class="p">:</span>
            <span class="c1"># The HIT was deleted, must rely on what we have</span>
            <span class="n">external_status</span> <span class="o">=</span> <span class="n">local_status</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected HIT status </span><span class="si">{</span><span class="n">hit_data</span><span class="p">[</span><span class="s1">&#39;HITStatus&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">external_status</span> <span class="o">!=</span> <span class="n">local_status</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">local_status</span> <span class="o">==</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">ASSIGNED</span> <span class="ow">and</span> <span class="n">external_status</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">AssignmentState</span><span class="o">.</span><span class="n">LAUNCHED</span><span class="p">,</span>
                <span class="n">AssignmentState</span><span class="o">.</span><span class="n">EXPIRED</span><span class="p">,</span>
            <span class="p">]:</span>
                <span class="c1"># Treat this as a return event, this hit may be doable by someone else</span>
                <span class="n">agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_assigned_agent</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">agent</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">agent</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span>
                    <span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_IN_TASK</span><span class="p">,</span>
                    <span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_ONBOARDING</span><span class="p">,</span>
                    <span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_WAITING</span><span class="p">,</span>
                    <span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_PARTNER_DISCONNECT</span><span class="p">,</span>
                <span class="p">]:</span>
                    <span class="c1"># mark the in-task agent as having returned the HIT, to</span>
                    <span class="c1"># free any running tasks and have Blueprint decide on cleanup.</span>
                    <span class="n">agent</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_RETURNED</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">external_status</span> <span class="o">==</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">EXPIRED</span><span class="p">:</span>
                    <span class="c1"># If we&#39;re expired, then it won&#39;t be doable, and we should update</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">set_db_status</span><span class="p">(</span><span class="n">external_status</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_db_status</span><span class="p">(</span><span class="n">external_status</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_status</span>

    <span class="k">def</span> <span class="nf">launch</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_url</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create this HIT on MTurk (making it availalbe) and register the ids in the local db&quot;&quot;&quot;</span>
        <span class="n">task_run</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_assignment</span><span class="p">()</span><span class="o">.</span><span class="n">get_task_run</span><span class="p">()</span>
        <span class="n">duration</span> <span class="o">=</span> <span class="n">task_run</span><span class="o">.</span><span class="n">get_task_args</span><span class="p">()</span><span class="o">.</span><span class="n">assignment_duration_in_seconds</span>
        <span class="n">run_id</span> <span class="o">=</span> <span class="n">task_run</span><span class="o">.</span><span class="n">db_id</span>
        <span class="n">run_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_run</span><span class="p">(</span><span class="n">run_id</span><span class="p">)</span>
        <span class="n">hit_type_id</span> <span class="o">=</span> <span class="n">run_details</span><span class="p">[</span><span class="s2">&quot;hit_type_id&quot;</span><span class="p">]</span>
        <span class="n">requester</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_requester</span><span class="p">()</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">frame_height</span> <span class="o">=</span> <span class="n">run_details</span><span class="p">[</span><span class="s2">&quot;frame_height&quot;</span><span class="p">]</span>
        <span class="n">hit_link</span><span class="p">,</span> <span class="n">hit_id</span><span class="p">,</span> <span class="n">response</span> <span class="o">=</span> <span class="n">create_hit_with_hit_type</span><span class="p">(</span>
            <span class="n">client</span><span class="p">,</span> <span class="n">frame_height</span><span class="p">,</span> <span class="n">task_url</span><span class="p">,</span> <span class="n">hit_type_id</span>
        <span class="p">)</span>
        <span class="c1"># TODO(OWN) get this link to the mephisto frontend</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">hit_link</span><span class="p">)</span>

        <span class="c1"># We create a hit for this unit, but note that this unit may not</span>
        <span class="c1"># necessarily match with the same HIT that was launched for it.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">new_hit</span><span class="p">(</span><span class="n">hit_id</span><span class="p">,</span> <span class="n">hit_link</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">run_id</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_db_status</span><span class="p">(</span><span class="n">AssignmentState</span><span class="o">.</span><span class="n">LAUNCHED</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">expire</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Send a request to expire the HIT, and if it&#39;s not assigned return,</span>
<span class="sd">        otherwise just return the maximum assignment duration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">delay</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">AssignmentState</span><span class="o">.</span><span class="n">EXPIRED</span><span class="p">,</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">delay</span>
        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">ASSIGNED</span><span class="p">:</span>
            <span class="c1"># The assignment is currently being worked on,</span>
            <span class="c1"># so we will set the wait time to be the</span>
            <span class="c1"># amount of time we granted for working on this assignment</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_time_in_seconds</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">delay</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">assignment_time_in_seconds</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Expiring a unit that is ASSIGNED after delay </span><span class="si">{</span><span class="n">delay</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">mturk_hit_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mturk_hit_id</span><span class="p">()</span>
        <span class="n">requester</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_requester</span><span class="p">()</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mturk_hit_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">expire_hit</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">mturk_hit_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">delay</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">unassigned_hit_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_unassigned_hit_ids</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">task_run_id</span><span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">unassigned_hit_ids</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">set_db_status</span><span class="p">(</span><span class="n">AssignmentState</span><span class="o">.</span><span class="n">EXPIRED</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">delay</span>
            <span class="n">hit_id</span> <span class="o">=</span> <span class="n">unassigned_hit_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">expire_hit</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">hit_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">register_assignment_to_hit</span><span class="p">(</span><span class="n">hit_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_id</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_db_status</span><span class="p">(</span><span class="n">AssignmentState</span><span class="o">.</span><span class="n">EXPIRED</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">delay</span>

    <span class="k">def</span> <span class="nf">is_expired</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine if this unit is expired as according to the vendor.</span>

<span class="sd">        In this case, we keep track of the expiration locally by refreshing</span>
<span class="sd">        the hit&#39;s status and seeing if we&#39;ve expired.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span> <span class="o">==</span> <span class="n">AssignmentState</span><span class="o">.</span><span class="n">EXPIRED</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span>
        <span class="n">db</span><span class="p">:</span> <span class="s2">&quot;MephistoDB&quot;</span><span class="p">,</span> <span class="n">assignment</span><span class="p">:</span> <span class="s2">&quot;Assignment&quot;</span><span class="p">,</span> <span class="n">index</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">pay_amount</span><span class="p">:</span> <span class="nb">float</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Unit&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create a Unit for the given assignment&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MTurkUnit</span><span class="o">.</span><span class="n">_register_unit</span><span class="p">(</span>
            <span class="n">db</span><span class="p">,</span> <span class="n">assignment</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">pay_amount</span><span class="p">,</span> <span class="n">PROVIDER_TYPE</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">db_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">get_mturk_hit_id</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">db_status</span><span class="si">}</span><span class="s2">)&quot;</span>
</pre></div>

        </details>

            <div class="docstring"><p>This class tracks the status of an individual worker's contribution to a
higher level assignment. It is the smallest 'unit' of work to complete
the assignment, and this class is only responsible for checking
the status of that work itself being done.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="mturk_unit.html#MTurkUnit">mephisto.abstractions.providers.mturk.mturk_unit.MTurkUnit</a></dt>
                                <dd id="MTurkProvider.UnitClass.__init__" class="function"><a href="mturk_unit.html#MTurkUnit.__init__">MTurkUnit</a></dd>
                <dd id="MTurkProvider.UnitClass.PROVIDER_TYPE" class="variable"><a href="mturk_unit.html#MTurkUnit.PROVIDER_TYPE">PROVIDER_TYPE</a></dd>
                <dd id="MTurkProvider.UnitClass.register_from_provider_data" class="function"><a href="mturk_unit.html#MTurkUnit.register_from_provider_data">register_from_provider_data</a></dd>
                <dd id="MTurkProvider.UnitClass.get_mturk_assignment_id" class="function"><a href="mturk_unit.html#MTurkUnit.get_mturk_assignment_id">get_mturk_assignment_id</a></dd>
                <dd id="MTurkProvider.UnitClass.get_mturk_hit_id" class="function"><a href="mturk_unit.html#MTurkUnit.get_mturk_hit_id">get_mturk_hit_id</a></dd>
                <dd id="MTurkProvider.UnitClass.get_requester" class="function"><a href="mturk_unit.html#MTurkUnit.get_requester">get_requester</a></dd>
                <dd id="MTurkProvider.UnitClass.set_db_status" class="function"><a href="mturk_unit.html#MTurkUnit.set_db_status">set_db_status</a></dd>
                <dd id="MTurkProvider.UnitClass.clear_assigned_agent" class="function"><a href="mturk_unit.html#MTurkUnit.clear_assigned_agent">clear_assigned_agent</a></dd>
                <dd id="MTurkProvider.UnitClass.get_status" class="function"><a href="mturk_unit.html#MTurkUnit.get_status">get_status</a></dd>
                <dd id="MTurkProvider.UnitClass.launch" class="function"><a href="mturk_unit.html#MTurkUnit.launch">launch</a></dd>
                <dd id="MTurkProvider.UnitClass.expire" class="function"><a href="mturk_unit.html#MTurkUnit.expire">expire</a></dd>
                <dd id="MTurkProvider.UnitClass.is_expired" class="function"><a href="mturk_unit.html#MTurkUnit.is_expired">is_expired</a></dd>
                <dd id="MTurkProvider.UnitClass.new" class="function"><a href="mturk_unit.html#MTurkUnit.new">new</a></dd>

            </div>
            <div><dt><a href="../../../data_model/unit.html#Unit">mephisto.data_model.unit.Unit</a></dt>
                                <dd id="MTurkProvider.UnitClass.get_crowd_provider_class" class="function"><a href="../../../data_model/unit.html#Unit.get_crowd_provider_class">get_crowd_provider_class</a></dd>
                <dd id="MTurkProvider.UnitClass.get_assignment_data" class="function"><a href="../../../data_model/unit.html#Unit.get_assignment_data">get_assignment_data</a></dd>
                <dd id="MTurkProvider.UnitClass.sync_status" class="function"><a href="../../../data_model/unit.html#Unit.sync_status">sync_status</a></dd>
                <dd id="MTurkProvider.UnitClass.get_db_status" class="function"><a href="../../../data_model/unit.html#Unit.get_db_status">get_db_status</a></dd>
                <dd id="MTurkProvider.UnitClass.get_assignment" class="function"><a href="../../../data_model/unit.html#Unit.get_assignment">get_assignment</a></dd>
                <dd id="MTurkProvider.UnitClass.get_task_run" class="function"><a href="../../../data_model/unit.html#Unit.get_task_run">get_task_run</a></dd>
                <dd id="MTurkProvider.UnitClass.get_task" class="function"><a href="../../../data_model/unit.html#Unit.get_task">get_task</a></dd>
                <dd id="MTurkProvider.UnitClass.get_assigned_agent" class="function"><a href="../../../data_model/unit.html#Unit.get_assigned_agent">get_assigned_agent</a></dd>
                <dd id="MTurkProvider.UnitClass.get_pay_amount" class="function"><a href="../../../data_model/unit.html#Unit.get_pay_amount">get_pay_amount</a></dd>

            </div>
            <div><dt><a href="../../../data_model/_db_backed_meta.html#MephistoDataModelComponentMixin">mephisto.data_model._db_backed_meta.MephistoDataModelComponentMixin</a></dt>
                                <dd id="MTurkProvider.UnitClass.get" class="function"><a href="../../../data_model/_db_backed_meta.html#MephistoDataModelComponentMixin.get">get</a></dd>
                <dd id="MTurkProvider.UnitClass.async_get" class="function"><a href="../../../data_model/_db_backed_meta.html#MephistoDataModelComponentMixin.async_get">async_get</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MTurkProvider.RequesterClass">
                                <div class="attr class">
        <a class="headerlink" href="#MTurkProvider.RequesterClass">#&nbsp;&nbsp</a>


        <span class="def">class</span>
        <span class="name">MTurkProvider.RequesterClass</span><wbr>(<span class="base"><a href="../../../data_model/requester.html#Requester">mephisto.data_model.requester.Requester</a></span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MTurkRequester</span><span class="p">(</span><span class="n">Requester</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper for requester behavior as provided by MTurk. Makes</span>
<span class="sd">    all requests directly to MTurk through boto3.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Ensure inherited methods use this level&#39;s provider type</span>
    <span class="n">PROVIDER_TYPE</span> <span class="o">=</span> <span class="n">PROVIDER_TYPE</span>
    <span class="n">ArgsClass</span> <span class="o">=</span> <span class="n">MTurkRequesterArgs</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">db</span><span class="p">:</span> <span class="s2">&quot;MephistoDB&quot;</span><span class="p">,</span>
        <span class="n">db_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">row</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_used_new_call</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">db_id</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">_used_new_call</span><span class="o">=</span><span class="n">_used_new_call</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="p">:</span> <span class="s2">&quot;MTurkDatastore&quot;</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_datastore_for_provider</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PROVIDER_TYPE</span>
        <span class="p">)</span>
        <span class="c1"># Use _requester_name to preserve sandbox behavior which</span>
        <span class="c1"># utilizes a different requester_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_requester_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">requester_name</span>

    <span class="k">def</span> <span class="nf">_get_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requester_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an mturk client for usage with mturk_utils</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_client_for_requester</span><span class="p">(</span><span class="n">requester_name</span><span class="p">)</span>

    <span class="c1"># Required functions for a Requester implementation</span>

    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">args</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DictConfig</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Register this requester with the crowd provider by providing any required credentials</span>
<span class="sd">        or such. If no args are provided, assume the registration is already made and try</span>
<span class="sd">        to assert it as such.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">req_field</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;access_key_id&quot;</span><span class="p">,</span> <span class="s2">&quot;secret_access_key&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">args</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">req_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;Missing IAM &quot;</span><span class="si">{</span><span class="n">req_field</span><span class="si">}</span><span class="s1">&quot; in requester registration args&#39;</span>
                <span class="p">)</span>
        <span class="n">setup_aws_credentials</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_registered</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Return whether or not this requester has registered yet&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">check_aws_credentials</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_available_budget</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Get the available budget from MTurk&quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">get_requester_balance</span><span class="p">(</span><span class="n">client</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_create_new_mturk_qualification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qualification_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create a new qualification on MTurk owned by the requester provided</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">qualification_desc</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Equivalent qualification for </span><span class="si">{</span><span class="n">qualification_name</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="n">use_qualification_name</span> <span class="o">=</span> <span class="n">qualification_name</span>
        <span class="n">qualification_id</span> <span class="o">=</span> <span class="n">find_or_create_mturk_qualification</span><span class="p">(</span>
            <span class="n">client</span><span class="p">,</span> <span class="n">qualification_name</span><span class="p">,</span> <span class="n">qualification_desc</span><span class="p">,</span> <span class="n">must_be_owned</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">qualification_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># Try to append time to make the qualification unique</span>
            <span class="n">use_qualification_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">qualification_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">qualification_id</span> <span class="o">=</span> <span class="n">find_or_create_mturk_qualification</span><span class="p">(</span>
                <span class="n">client</span><span class="p">,</span> <span class="n">use_qualification_name</span><span class="p">,</span> <span class="n">qualification_desc</span><span class="p">,</span> <span class="n">must_be_owned</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="n">attempts</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">qualification_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="c1"># Append something somewhat random</span>
                <span class="n">use_qualification_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">qualification_name</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="n">qualification_id</span> <span class="o">=</span> <span class="n">find_or_create_mturk_qualification</span><span class="p">(</span>
                    <span class="n">client</span><span class="p">,</span>
                    <span class="n">use_qualification_name</span><span class="p">,</span>
                    <span class="n">qualification_desc</span><span class="p">,</span>
                    <span class="n">must_be_owned</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">attempts</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">attempts</span> <span class="o">&gt;</span> <span class="n">MAX_QUALIFICATION_ATTEMPTS</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                        <span class="s2">&quot;Something has gone extremely wrong with creating qualification &quot;</span>
                        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">qualification_name</span><span class="si">}</span><span class="s2"> for requester </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">requester_name</span><span class="si">}</span><span class="s2">&quot;</span>
                    <span class="p">)</span>
        <span class="c1"># Store the new qualification in the datastore</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">create_qualification_mapping</span><span class="p">(</span>
            <span class="n">qualification_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">db_id</span><span class="p">,</span> <span class="n">use_qualification_name</span><span class="p">,</span> <span class="n">qualification_id</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">qualification_id</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="s2">&quot;MephistoDB&quot;</span><span class="p">,</span> <span class="n">requester_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Requester&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MTurkRequester</span><span class="o">.</span><span class="n">_register_requester</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">requester_name</span><span class="p">,</span> <span class="n">PROVIDER_TYPE</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Wrapper for requester behavior as provided by MTurk. Makes
all requests directly to MTurk through boto3.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="mturk_requester.html#MTurkRequester">mephisto.abstractions.providers.mturk.mturk_requester.MTurkRequester</a></dt>
                                <dd id="MTurkProvider.RequesterClass.__init__" class="function"><a href="mturk_requester.html#MTurkRequester.__init__">MTurkRequester</a></dd>
                <dd id="MTurkProvider.RequesterClass.PROVIDER_TYPE" class="variable"><a href="mturk_requester.html#MTurkRequester.PROVIDER_TYPE">PROVIDER_TYPE</a></dd>
                <dd id="MTurkProvider.RequesterClass.ArgsClass" class="class"><a href="mturk_requester.html#MTurkRequester.ArgsClass">ArgsClass</a></dd>
                <dd id="MTurkProvider.RequesterClass.register" class="function"><a href="mturk_requester.html#MTurkRequester.register">register</a></dd>
                <dd id="MTurkProvider.RequesterClass.is_registered" class="function"><a href="mturk_requester.html#MTurkRequester.is_registered">is_registered</a></dd>
                <dd id="MTurkProvider.RequesterClass.get_available_budget" class="function"><a href="mturk_requester.html#MTurkRequester.get_available_budget">get_available_budget</a></dd>
                <dd id="MTurkProvider.RequesterClass.new" class="function"><a href="mturk_requester.html#MTurkRequester.new">new</a></dd>

            </div>
            <div><dt><a href="../../../data_model/requester.html#Requester">mephisto.data_model.requester.Requester</a></dt>
                                <dd id="MTurkProvider.RequesterClass.get_task_runs" class="function"><a href="../../../data_model/requester.html#Requester.get_task_runs">get_task_runs</a></dd>
                <dd id="MTurkProvider.RequesterClass.get_total_spend" class="function"><a href="../../../data_model/requester.html#Requester.get_total_spend">get_total_spend</a></dd>
                <dd id="MTurkProvider.RequesterClass.is_sandbox" class="function"><a href="../../../data_model/requester.html#Requester.is_sandbox">is_sandbox</a></dd>
                <dd id="MTurkProvider.RequesterClass.to_dict" class="function"><a href="../../../data_model/requester.html#Requester.to_dict">to_dict</a></dd>

            </div>
            <div><dt><a href="../../../data_model/_db_backed_meta.html#MephistoDataModelComponentMixin">mephisto.data_model._db_backed_meta.MephistoDataModelComponentMixin</a></dt>
                                <dd id="MTurkProvider.RequesterClass.get" class="function"><a href="../../../data_model/_db_backed_meta.html#MephistoDataModelComponentMixin.get">get</a></dd>
                <dd id="MTurkProvider.RequesterClass.async_get" class="function"><a href="../../../data_model/_db_backed_meta.html#MephistoDataModelComponentMixin.async_get">async_get</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MTurkProvider.WorkerClass">
                                <div class="attr class">
        <a class="headerlink" href="#MTurkProvider.WorkerClass">#&nbsp;&nbsp</a>


        <span class="def">class</span>
        <span class="name">MTurkProvider.WorkerClass</span><wbr>(<span class="base"><a href="../../../data_model/worker.html#Worker">mephisto.data_model.worker.Worker</a></span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MTurkWorker</span><span class="p">(</span><span class="n">Worker</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class represents an individual - namely a person. It maintains components of ongoing identity for a user.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Ensure inherited methods use this level&#39;s provider type</span>
    <span class="n">PROVIDER_TYPE</span> <span class="o">=</span> <span class="n">PROVIDER_TYPE</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">db</span><span class="p">:</span> <span class="s2">&quot;MephistoDB&quot;</span><span class="p">,</span>
        <span class="n">db_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">row</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_used_new_call</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">db_id</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">_used_new_call</span><span class="o">=</span><span class="n">_used_new_call</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="p">:</span> <span class="s2">&quot;MTurkDatastore&quot;</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_datastore_for_provider</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PROVIDER_TYPE</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_worker_name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">worker_name</span>  <span class="c1"># sandbox workers use a different name</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_from_mturk_worker_id</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> <span class="n">db</span><span class="p">:</span> <span class="s2">&quot;MephistoDB&quot;</span><span class="p">,</span> <span class="n">mturk_worker_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;MTurkWorker&quot;</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Get the MTurkWorker from the given worker_id&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">PROVIDER_TYPE</span> <span class="o">!=</span> <span class="n">PROVIDER_TYPE</span><span class="p">:</span>
            <span class="n">mturk_worker_id</span> <span class="o">+=</span> <span class="s2">&quot;_sandbox&quot;</span>
        <span class="n">workers</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">find_workers</span><span class="p">(</span>
            <span class="n">worker_name</span><span class="o">=</span><span class="n">mturk_worker_id</span><span class="p">,</span> <span class="n">provider_type</span><span class="o">=</span><span class="bp">cls</span><span class="o">.</span><span class="n">PROVIDER_TYPE</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">workers</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Could not find a Mephisto Worker for mturk_id </span><span class="si">{</span><span class="n">mturk_worker_id</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;MTurkWorker&quot;</span><span class="p">,</span> <span class="n">workers</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_mturk_worker_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worker_name</span>

    <span class="k">def</span> <span class="nf">_get_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requester_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an mturk client for usage with mturk_utils</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_client_for_requester</span><span class="p">(</span><span class="n">requester_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">grant_crowd_qualification</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">qualification_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Grant a qualification by the given name to this worker. Check the local</span>
<span class="sd">        MTurk db to find the matching MTurk qualification to grant, and pass</span>
<span class="sd">        that. If no qualification exists, try to create one.</span>

<span class="sd">        In creating a new qualification, Mephisto resolves the ambiguity over which</span>
<span class="sd">        requester to associate that qualification with by using the FIRST requester</span>
<span class="sd">        of the given account type (either `mturk` or `mturk_sandbox`)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mturk_qual_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_qualification_mapping</span><span class="p">(</span>
            <span class="n">qualification_name</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">mturk_qual_details</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">requester</span> <span class="o">=</span> <span class="n">Requester</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">mturk_qual_details</span><span class="p">[</span><span class="s2">&quot;requester_id&quot;</span><span class="p">])</span>
            <span class="n">qualification_id</span> <span class="o">=</span> <span class="n">mturk_qual_details</span><span class="p">[</span><span class="s2">&quot;mturk_qualification_id&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target_type</span> <span class="o">=</span> <span class="p">(</span>
                <span class="s2">&quot;mturk_sandbox&quot;</span> <span class="k">if</span> <span class="n">qualification_name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;sandbox&quot;</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;mturk&quot;</span>
            <span class="p">)</span>
            <span class="n">requester</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">find_requesters</span><span class="p">(</span><span class="n">provider_type</span><span class="o">=</span><span class="n">target_type</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
                <span class="n">requester</span><span class="p">,</span> <span class="n">MTurkRequester</span>
            <span class="p">),</span> <span class="s2">&quot;find_requesters must return mturk requester for given provider types&quot;</span>
            <span class="n">qualification_id</span> <span class="o">=</span> <span class="n">requester</span><span class="o">.</span><span class="n">_create_new_mturk_qualification</span><span class="p">(</span>
                <span class="n">qualification_name</span>
            <span class="p">)</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">requester</span><span class="p">,</span> <span class="n">MTurkRequester</span>
        <span class="p">),</span> <span class="s2">&quot;Must be an MTurk requester for MTurk quals&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">give_worker_qualification</span><span class="p">(</span>
            <span class="n">client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mturk_worker_id</span><span class="p">(),</span> <span class="n">qualification_id</span><span class="p">,</span> <span class="n">value</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">revoke_crowd_qualification</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">qualification_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Revoke the qualification by the given name from this worker. Check the local</span>
<span class="sd">        MTurk db to find the matching MTurk qualification to revoke, pass if</span>
<span class="sd">        no such qualification exists.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mturk_qual_details</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_qualification_mapping</span><span class="p">(</span>
            <span class="n">qualification_name</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">mturk_qual_details</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;No locally stored MTurk qualification to revoke for name </span><span class="si">{</span><span class="n">qualification_name</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">requester</span> <span class="o">=</span> <span class="n">Requester</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="p">,</span> <span class="n">mturk_qual_details</span><span class="p">[</span><span class="s2">&quot;requester_id&quot;</span><span class="p">])</span>
        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">requester</span><span class="p">,</span> <span class="n">MTurkRequester</span>
        <span class="p">),</span> <span class="s2">&quot;Must be an MTurk requester from MTurk quals&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">qualification_id</span> <span class="o">=</span> <span class="n">mturk_qual_details</span><span class="p">[</span><span class="s2">&quot;mturk_qualification_id&quot;</span><span class="p">]</span>
        <span class="n">remove_worker_qualification</span><span class="p">(</span>
            <span class="n">client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_mturk_worker_id</span><span class="p">(),</span> <span class="n">qualification_id</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">bonus_worker</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">amount</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Bonus this worker for work any reason. Return tuple of success and failure message&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># TODO(#652) implement. The content in scripts/mturk/launch_makeup_hits.py</span>
            <span class="c1"># may prove useful for this.</span>
            <span class="k">return</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;bonusing via compensation tasks not yet available&quot;</span>

        <span class="n">unit</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;MTurkUnit&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="p">)</span>
        <span class="n">requester</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span>
            <span class="s2">&quot;MTurkRequester&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">.</span><span class="n">get_assignment</span><span class="p">()</span><span class="o">.</span><span class="n">get_task_run</span><span class="p">()</span><span class="o">.</span><span class="n">get_requester</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">mturk_assignment_id</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">get_mturk_assignment_id</span><span class="p">()</span>
        <span class="k">assert</span> <span class="n">mturk_assignment_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Cannot bonus for a unit with no agent&quot;</span>
        <span class="n">pay_bonus</span><span class="p">(</span>
            <span class="n">client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worker_name</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">mturk_assignment_id</span><span class="p">,</span> <span class="n">reason</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">block_worker</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">unit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Unit&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">requester</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;Requester&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
        <span class="sd">&quot;&quot;&quot;Block this worker for a specified reason. Return success of block&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">unit</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">requester</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># TODO(WISH) soft block from all requesters? Maybe have the main</span>
            <span class="c1"># requester soft block?</span>
            <span class="k">return</span> <span class="p">(</span>
                <span class="kc">False</span><span class="p">,</span>
                <span class="s2">&quot;Blocking without a unit or requester not yet supported for MTurkWorkers&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">unit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">requester</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">requester</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">get_assignment</span><span class="p">()</span><span class="o">.</span><span class="n">get_task_run</span><span class="p">()</span><span class="o">.</span><span class="n">get_requester</span><span class="p">()</span>
        <span class="n">requester</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;MTurkRequester&quot;</span><span class="p">,</span> <span class="n">requester</span><span class="p">)</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">block_worker</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worker_name</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span><span class="p">,</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">unblock_worker</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">requester</span><span class="p">:</span> <span class="s2">&quot;Requester&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;unblock a blocked worker for the specified reason. Return success of unblock&quot;&quot;&quot;</span>
        <span class="n">requester</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;MTurkRequester&quot;</span><span class="p">,</span> <span class="n">requester</span><span class="p">)</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="n">unblock_worker</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worker_name</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">is_blocked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requester</span><span class="p">:</span> <span class="s2">&quot;Requester&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Determine if a worker is blocked&quot;&quot;&quot;</span>
        <span class="n">requester</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;MTurkRequester&quot;</span><span class="p">,</span> <span class="n">requester</span><span class="p">)</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">is_worker_blocked</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_worker_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_eligible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">task_run</span><span class="p">:</span> <span class="s2">&quot;TaskRun&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Qualifications are handled primarily by MTurk, so if a worker is able to get</span>
<span class="sd">        through to be able to access the task, they should be eligible</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="s2">&quot;MephistoDB&quot;</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Worker&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">MTurkWorker</span><span class="o">.</span><span class="n">_register_worker</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">worker_id</span><span class="p">,</span> <span class="n">PROVIDER_TYPE</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>This class represents an individual - namely a person. It maintains components of ongoing identity for a user.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="mturk_worker.html#MTurkWorker">mephisto.abstractions.providers.mturk.mturk_worker.MTurkWorker</a></dt>
                                <dd id="MTurkProvider.WorkerClass.__init__" class="function"><a href="mturk_worker.html#MTurkWorker.__init__">MTurkWorker</a></dd>
                <dd id="MTurkProvider.WorkerClass.PROVIDER_TYPE" class="variable"><a href="mturk_worker.html#MTurkWorker.PROVIDER_TYPE">PROVIDER_TYPE</a></dd>
                <dd id="MTurkProvider.WorkerClass.get_from_mturk_worker_id" class="function"><a href="mturk_worker.html#MTurkWorker.get_from_mturk_worker_id">get_from_mturk_worker_id</a></dd>
                <dd id="MTurkProvider.WorkerClass.get_mturk_worker_id" class="function"><a href="mturk_worker.html#MTurkWorker.get_mturk_worker_id">get_mturk_worker_id</a></dd>
                <dd id="MTurkProvider.WorkerClass.grant_crowd_qualification" class="function"><a href="mturk_worker.html#MTurkWorker.grant_crowd_qualification">grant_crowd_qualification</a></dd>
                <dd id="MTurkProvider.WorkerClass.revoke_crowd_qualification" class="function"><a href="mturk_worker.html#MTurkWorker.revoke_crowd_qualification">revoke_crowd_qualification</a></dd>
                <dd id="MTurkProvider.WorkerClass.bonus_worker" class="function"><a href="mturk_worker.html#MTurkWorker.bonus_worker">bonus_worker</a></dd>
                <dd id="MTurkProvider.WorkerClass.block_worker" class="function"><a href="mturk_worker.html#MTurkWorker.block_worker">block_worker</a></dd>
                <dd id="MTurkProvider.WorkerClass.unblock_worker" class="function"><a href="mturk_worker.html#MTurkWorker.unblock_worker">unblock_worker</a></dd>
                <dd id="MTurkProvider.WorkerClass.is_blocked" class="function"><a href="mturk_worker.html#MTurkWorker.is_blocked">is_blocked</a></dd>
                <dd id="MTurkProvider.WorkerClass.is_eligible" class="function"><a href="mturk_worker.html#MTurkWorker.is_eligible">is_eligible</a></dd>
                <dd id="MTurkProvider.WorkerClass.new" class="function"><a href="mturk_worker.html#MTurkWorker.new">new</a></dd>

            </div>
            <div><dt><a href="../../../data_model/worker.html#Worker">mephisto.data_model.worker.Worker</a></dt>
                                <dd id="MTurkProvider.WorkerClass.get_agents" class="function"><a href="../../../data_model/worker.html#Worker.get_agents">get_agents</a></dd>
                <dd id="MTurkProvider.WorkerClass.new_from_provider_data" class="function"><a href="../../../data_model/worker.html#Worker.new_from_provider_data">new_from_provider_data</a></dd>
                <dd id="MTurkProvider.WorkerClass.get_granted_qualification" class="function"><a href="../../../data_model/worker.html#Worker.get_granted_qualification">get_granted_qualification</a></dd>
                <dd id="MTurkProvider.WorkerClass.is_disqualified" class="function"><a href="../../../data_model/worker.html#Worker.is_disqualified">is_disqualified</a></dd>
                <dd id="MTurkProvider.WorkerClass.is_qualified" class="function"><a href="../../../data_model/worker.html#Worker.is_qualified">is_qualified</a></dd>
                <dd id="MTurkProvider.WorkerClass.revoke_qualification" class="function"><a href="../../../data_model/worker.html#Worker.revoke_qualification">revoke_qualification</a></dd>
                <dd id="MTurkProvider.WorkerClass.grant_qualification" class="function"><a href="../../../data_model/worker.html#Worker.grant_qualification">grant_qualification</a></dd>
                <dd id="MTurkProvider.WorkerClass.register" class="function"><a href="../../../data_model/worker.html#Worker.register">register</a></dd>

            </div>
            <div><dt><a href="../../../data_model/_db_backed_meta.html#MephistoDataModelComponentMixin">mephisto.data_model._db_backed_meta.MephistoDataModelComponentMixin</a></dt>
                                <dd id="MTurkProvider.WorkerClass.get" class="function"><a href="../../../data_model/_db_backed_meta.html#MephistoDataModelComponentMixin.get">get</a></dd>
                <dd id="MTurkProvider.WorkerClass.async_get" class="function"><a href="../../../data_model/_db_backed_meta.html#MephistoDataModelComponentMixin.async_get">async_get</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MTurkProvider.AgentClass">
                                <div class="attr class">
        <a class="headerlink" href="#MTurkProvider.AgentClass">#&nbsp;&nbsp</a>


        <span class="def">class</span>
        <span class="name">MTurkProvider.AgentClass</span><wbr>(<span class="base"><a href="../../../data_model/agent.html#Agent">mephisto.data_model.agent.Agent</a></span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MTurkAgent</span><span class="p">(</span><span class="n">Agent</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class encompasses a worker as they are working on an individual assignment.</span>
<span class="sd">    It maintains details for the current task at hand such as start and end time,</span>
<span class="sd">    connection status, etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Ensure inherited methods use this level&#39;s provider type</span>
    <span class="n">PROVIDER_TYPE</span> <span class="o">=</span> <span class="n">PROVIDER_TYPE</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">db</span><span class="p">:</span> <span class="s2">&quot;MephistoDB&quot;</span><span class="p">,</span>
        <span class="n">db_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">row</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Mapping</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">_used_new_call</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">db_id</span><span class="p">,</span> <span class="n">row</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">_used_new_call</span><span class="o">=</span><span class="n">_used_new_call</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="p">:</span> <span class="s2">&quot;MTurkDatastore&quot;</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_datastore_for_provider</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">PROVIDER_TYPE</span>
        <span class="p">)</span>
        <span class="n">unit</span><span class="p">:</span> <span class="s2">&quot;MTurkUnit&quot;</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;MTurkUnit&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unit</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mturk_assignment_id</span> <span class="o">=</span> <span class="n">unit</span><span class="o">.</span><span class="n">get_mturk_assignment_id</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_get_mturk_assignment_id</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mturk_assignment_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mturk_assignment_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unit</span><span class="p">()</span><span class="o">.</span><span class="n">get_mturk_assignment_id</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mturk_assignment_id</span>

    <span class="k">def</span> <span class="nf">_get_client</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get an mturk client for usage with mturk_utils for this agent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_unit</span><span class="p">()</span>
        <span class="n">requester</span><span class="p">:</span> <span class="s2">&quot;MTurkRequester&quot;</span> <span class="o">=</span> <span class="n">cast</span><span class="p">(</span><span class="s2">&quot;MTurkRequester&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="o">.</span><span class="n">get_requester</span><span class="p">())</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">datastore</span><span class="o">.</span><span class="n">get_client_for_requester</span><span class="p">(</span><span class="n">requester</span><span class="o">.</span><span class="n">_requester_name</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">new_from_provider_data</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">db</span><span class="p">:</span> <span class="s2">&quot;MephistoDB&quot;</span><span class="p">,</span>
        <span class="n">worker</span><span class="p">:</span> <span class="s2">&quot;Worker&quot;</span><span class="p">,</span>
        <span class="n">unit</span><span class="p">:</span> <span class="s2">&quot;Unit&quot;</span><span class="p">,</span>
        <span class="n">provider_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Agent&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper around the new method that allows registering additional</span>
<span class="sd">        bookkeeping information from a crowd provider for this agent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">mephisto.abstractions.providers.mturk.mturk_unit</span> <span class="kn">import</span> <span class="n">MTurkUnit</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span>
            <span class="n">unit</span><span class="p">,</span> <span class="n">MTurkUnit</span>
        <span class="p">),</span> <span class="s2">&quot;Can only register mturk agents to mturk units&quot;</span>
        <span class="n">unit</span><span class="o">.</span><span class="n">register_from_provider_data</span><span class="p">(</span>
            <span class="n">provider_data</span><span class="p">[</span><span class="s2">&quot;hit_id&quot;</span><span class="p">],</span> <span class="n">provider_data</span><span class="p">[</span><span class="s2">&quot;assignment_id&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">new_from_provider_data</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">worker</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">provider_data</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">attempt_to_reconcile_submitted_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mturk_hit_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Hacky attempt to load the data directly from MTurk to handle</span>
<span class="sd">        data submitted that we missed somehow. Chance of failure is</span>
<span class="sd">        certainly non-zero.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">()</span>
        <span class="n">assignment</span> <span class="o">=</span> <span class="n">get_assignments_for_hit</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="n">mturk_hit_id</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">xml_data</span> <span class="o">=</span> <span class="n">xmltodict</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">assignment</span><span class="p">[</span><span class="s2">&quot;Answer&quot;</span><span class="p">])</span>
        <span class="n">paired_data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">xml_data</span><span class="p">[</span><span class="s2">&quot;QuestionFormAnswers&quot;</span><span class="p">][</span><span class="s2">&quot;Answer&quot;</span><span class="p">]))</span>
        <span class="n">parsed_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;QuestionIdentifier&quot;</span><span class="p">]:</span> <span class="n">entry</span><span class="p">[</span><span class="s2">&quot;FreeText&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">paired_data</span>
        <span class="p">}</span>
        <span class="n">parsed_data</span><span class="p">[</span><span class="s2">&quot;MEPHISTO_MTURK_RECONCILED&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handle_submit</span><span class="p">(</span><span class="n">parsed_data</span><span class="p">)</span>

    <span class="c1"># Required functions for Agent Interface</span>

    <span class="k">def</span> <span class="nf">approve_work</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Approve the work done on this specific Unit&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span> <span class="o">==</span> <span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_APPROVED</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Approving already approved agent </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">, skipping&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">()</span>
        <span class="n">approve_work</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mturk_assignment_id</span><span class="p">(),</span> <span class="n">override_rejection</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_APPROVED</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">reject_work</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">reason</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Reject the work done on this specific Unit&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span> <span class="o">==</span> <span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_APPROVED</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot reject </span><span class="si">{</span><span class="bp">self</span><span class="si">}</span><span class="s2">, it is already approved&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_client</span><span class="p">()</span>
        <span class="n">reject_work</span><span class="p">(</span><span class="n">client</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_mturk_assignment_id</span><span class="p">(),</span> <span class="n">reason</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_status</span><span class="p">(</span><span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_REJECTED</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">mark_done</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        MTurk agents are marked as done on the side of MTurk, so if this agent</span>
<span class="sd">        is marked as done there&#39;s nothing else we need to do as the task has been</span>
<span class="sd">        submitted.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_status</span><span class="p">()</span> <span class="o">!=</span> <span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_DISCONNECT</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">update_agent</span><span class="p">(</span>
                <span class="n">agent_id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">db_id</span><span class="p">,</span> <span class="n">status</span><span class="o">=</span><span class="n">AgentState</span><span class="o">.</span><span class="n">STATUS_COMPLETED</span>
            <span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">new</span><span class="p">(</span><span class="n">db</span><span class="p">:</span> <span class="s2">&quot;MephistoDB&quot;</span><span class="p">,</span> <span class="n">worker</span><span class="p">:</span> <span class="s2">&quot;Worker&quot;</span><span class="p">,</span> <span class="n">unit</span><span class="p">:</span> <span class="s2">&quot;Unit&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Agent&quot;</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Create an agent for this worker to be used for work on the given Unit.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">MTurkAgent</span><span class="o">.</span><span class="n">_register_agent</span><span class="p">(</span><span class="n">db</span><span class="p">,</span> <span class="n">worker</span><span class="p">,</span> <span class="n">unit</span><span class="p">,</span> <span class="n">PROVIDER_TYPE</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>This class encompasses a worker as they are working on an individual assignment.
It maintains details for the current task at hand such as start and end time,
connection status, etc.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="mturk_agent.html#MTurkAgent">mephisto.abstractions.providers.mturk.mturk_agent.MTurkAgent</a></dt>
                                <dd id="MTurkProvider.AgentClass.__init__" class="function"><a href="mturk_agent.html#MTurkAgent.__init__">MTurkAgent</a></dd>
                <dd id="MTurkProvider.AgentClass.PROVIDER_TYPE" class="variable"><a href="mturk_agent.html#MTurkAgent.PROVIDER_TYPE">PROVIDER_TYPE</a></dd>
                <dd id="MTurkProvider.AgentClass.new_from_provider_data" class="function"><a href="mturk_agent.html#MTurkAgent.new_from_provider_data">new_from_provider_data</a></dd>
                <dd id="MTurkProvider.AgentClass.attempt_to_reconcile_submitted_data" class="function"><a href="mturk_agent.html#MTurkAgent.attempt_to_reconcile_submitted_data">attempt_to_reconcile_submitted_data</a></dd>
                <dd id="MTurkProvider.AgentClass.approve_work" class="function"><a href="mturk_agent.html#MTurkAgent.approve_work">approve_work</a></dd>
                <dd id="MTurkProvider.AgentClass.reject_work" class="function"><a href="mturk_agent.html#MTurkAgent.reject_work">reject_work</a></dd>
                <dd id="MTurkProvider.AgentClass.mark_done" class="function"><a href="mturk_agent.html#MTurkAgent.mark_done">mark_done</a></dd>
                <dd id="MTurkProvider.AgentClass.new" class="function"><a href="mturk_agent.html#MTurkAgent.new">new</a></dd>

            </div>
            <div><dt><a href="../../../data_model/agent.html#Agent">mephisto.data_model.agent.Agent</a></dt>
                                <dd id="MTurkProvider.AgentClass.state" class="variable"><a href="../../../data_model/agent.html#Agent.state">state</a></dd>
                <dd id="MTurkProvider.AgentClass.set_live_run" class="function"><a href="../../../data_model/agent.html#Agent.set_live_run">set_live_run</a></dd>
                <dd id="MTurkProvider.AgentClass.get_live_run" class="function"><a href="../../../data_model/agent.html#Agent.get_live_run">get_live_run</a></dd>
                <dd id="MTurkProvider.AgentClass.get_agent_id" class="function"><a href="../../../data_model/agent.html#Agent.get_agent_id">get_agent_id</a></dd>
                <dd id="MTurkProvider.AgentClass.get_worker" class="function"><a href="../../../data_model/agent.html#Agent.get_worker">get_worker</a></dd>
                <dd id="MTurkProvider.AgentClass.get_unit" class="function"><a href="../../../data_model/agent.html#Agent.get_unit">get_unit</a></dd>
                <dd id="MTurkProvider.AgentClass.get_assignment" class="function"><a href="../../../data_model/agent.html#Agent.get_assignment">get_assignment</a></dd>
                <dd id="MTurkProvider.AgentClass.get_task_run" class="function"><a href="../../../data_model/agent.html#Agent.get_task_run">get_task_run</a></dd>
                <dd id="MTurkProvider.AgentClass.get_task" class="function"><a href="../../../data_model/agent.html#Agent.get_task">get_task</a></dd>
                <dd id="MTurkProvider.AgentClass.get_data_dir" class="function"><a href="../../../data_model/agent.html#Agent.get_data_dir">get_data_dir</a></dd>
                <dd id="MTurkProvider.AgentClass.update_status" class="function"><a href="../../../data_model/agent.html#Agent.update_status">update_status</a></dd>
                <dd id="MTurkProvider.AgentClass.observe" class="function"><a href="../../../data_model/agent.html#Agent.observe">observe</a></dd>
                <dd id="MTurkProvider.AgentClass.get_live_update" class="function"><a href="../../../data_model/agent.html#Agent.get_live_update">get_live_update</a></dd>
                <dd id="MTurkProvider.AgentClass.act" class="function"><a href="../../../data_model/agent.html#Agent.act">act</a></dd>
                <dd id="MTurkProvider.AgentClass.await_submit" class="function"><a href="../../../data_model/agent.html#Agent.await_submit">await_submit</a></dd>
                <dd id="MTurkProvider.AgentClass.handle_submit" class="function"><a href="../../../data_model/agent.html#Agent.handle_submit">handle_submit</a></dd>
                <dd id="MTurkProvider.AgentClass.get_status" class="function"><a href="../../../data_model/agent.html#Agent.get_status">get_status</a></dd>
                <dd id="MTurkProvider.AgentClass.shutdown" class="function"><a href="../../../data_model/agent.html#Agent.shutdown">shutdown</a></dd>
                <dd id="MTurkProvider.AgentClass.soft_reject_work" class="function"><a href="../../../data_model/agent.html#Agent.soft_reject_work">soft_reject_work</a></dd>

            </div>
            <div><dt><a href="../../../data_model/_db_backed_meta.html#MephistoDataModelComponentMixin">mephisto.data_model._db_backed_meta.MephistoDataModelComponentMixin</a></dt>
                                <dd id="MTurkProvider.AgentClass.get" class="function"><a href="../../../data_model/_db_backed_meta.html#MephistoDataModelComponentMixin.get">get</a></dd>
                <dd id="MTurkProvider.AgentClass.async_get" class="function"><a href="../../../data_model/_db_backed_meta.html#MephistoDataModelComponentMixin.async_get">async_get</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MTurkProvider.ArgsClass">
                                <div class="attr class">
        <a class="headerlink" href="#MTurkProvider.ArgsClass">#&nbsp;&nbsp</a>


        <span class="def">class</span>
        <span class="name">MTurkProvider.ArgsClass</span><wbr>(<span class="base"><a href="../../crowd_provider.html#ProviderArgs">mephisto.abstractions.crowd_provider.ProviderArgs</a></span>):
    </div>

            <details>
            <summary>View Source</summary>
            <div class="pdoc-code codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MTurkProviderArgs</span><span class="p">(</span><span class="n">ProviderArgs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Provider args for an MTurk provider&quot;&quot;&quot;</span>

    <span class="n">_provider_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">PROVIDER_TYPE</span>
</pre></div>

        </details>

            <div class="docstring"><p>Provider args for an MTurk provider</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#MTurkProviderArgs">MTurkProviderArgs</a></dt>
                                <dd id="MTurkProvider.ArgsClass.__init__" class="function"><a href="#MTurkProviderArgs.__init__">MTurkProviderArgs</a></dd>

            </div>
            <div><dt><a href="../../crowd_provider.html#ProviderArgs">mephisto.abstractions.crowd_provider.ProviderArgs</a></dt>
                                <dd id="MTurkProvider.ArgsClass.requester_name" class="variable"><a href="../../crowd_provider.html#ProviderArgs.requester_name">requester_name</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.type) {
                    case "function":
                        heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span><span class="signature">${doc.signature}:</span>`;
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value">${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.type}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>