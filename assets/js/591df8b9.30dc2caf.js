"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[9705],{4127:function(e,t,n){n.d(t,{Zo:function(){return m},kt:function(){return f}});var i=n(1987);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),u=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},m=function(e){var t=u(e.components);return i.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),p=u(n),c=a,f=p["".concat(s,".").concat(c)]||p[c]||d[c]||r;return n?i.createElement(f,o(o({ref:t},m),{},{components:n})):i.createElement(f,o({ref:t},m))}));function f(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,o=new Array(r);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:a,o[1]=l;for(var u=2;u<r;u++)o[u]=n[u];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}c.displayName="MDXCreateElement"},2296:function(e,t,n){n.r(t),n.d(t,{assets:function(){return m},contentTitle:function(){return s},default:function(){return c},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return p}});var i=n(9375),a=n(8933),r=(n(1987),n(4127)),o=["components"],l={sidebar_position:7},s="Using code insertions",u={unversionedId:"guides/how_to_use/form_composer/configuration/insertions",id:"guides/how_to_use/form_composer/configuration/insertions",title:"Using code insertions",description:"FormComposer allows using custom code insertions in these scenarios:",source:"@site/docs/guides/how_to_use/form_composer/configuration/insertions.md",sourceDirName:"guides/how_to_use/form_composer/configuration",slug:"/guides/how_to_use/form_composer/configuration/insertions",permalink:"/docs/guides/how_to_use/form_composer/configuration/insertions",draft:!1,editUrl:"https://github.com/facebookresearch/Mephisto/tree/main/docs/web/docs/guides/how_to_use/form_composer/configuration/insertions.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"guides",previous:{title:"Form rendering callbacks",permalink:"/docs/guides/how_to_use/form_composer/configuration/form_callbacks"},next:{title:"Embed FormComposer into custom application",permalink:"/docs/guides/how_to_use/form_composer/embedding"}},m={},p=[{value:"HTML content insertion",id:"html-content-insertion",level:2},{value:"Insertion without token",id:"insertion-without-token",level:4},{value:"Insertion via token",id:"insertion-via-token",level:4},{value:"JS validator insertion",id:"js-validator-insertion",level:2},{value:"JS trigger insertion",id:"js-trigger-insertion",level:2},{value:"JS trigger helpers",id:"js-trigger-helpers",level:4},{value:"CSS styles insertions",id:"css-styles-insertions",level:2}],d={toc:p};function c(e){var t=e.components,n=(0,a.Z)(e,o);return(0,r.kt)("wrapper",(0,i.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"using-code-insertions"},"Using code insertions"),(0,r.kt)("p",null,"FormComposer allows using custom code insertions in these scenarios:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},'Specify lengthy content of an attribute (e.g. "instruction") in a separate HTML file'),(0,r.kt)("li",{parentName:"ul"},"Define custom validators for form fileds in a JS file"),(0,r.kt)("li",{parentName:"ul"},"Define custom triggers for form fileds, sections and submit button in a JS file"),(0,r.kt)("li",{parentName:"ul"},"Define custom styles for the FormComposer UI in a CSS file")),(0,r.kt)("p",null,'The inserted code must reside in separate files (called "insertion files") located in ',(0,r.kt)("inlineCode",{parentName:"p"},"insertions")," subdirectory of your form config directory."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Remember that you can change default config directory path using ",(0,r.kt)("inlineCode",{parentName:"em"},"--directory")," option of ",(0,r.kt)("inlineCode",{parentName:"em"},"form_composer config")," command"))),(0,r.kt)("hr",null),(0,r.kt)("h2",{id:"html-content-insertion"},"HTML content insertion"),(0,r.kt)("p",null,"An HTML insertion file is specified as a file path that's relative to the form config. It can be inserted directly into ",(0,r.kt)("inlineCode",{parentName:"p"},"unit_config.json")," config, or via a token."),(0,r.kt)("h4",{id:"insertion-without-token"},"Insertion without token"),(0,r.kt)("p",null,"Simply set entire value of an attribute to the insertion file's path.\nThis is equivalent to setting value of that attribute to content of the HTML file (except now you don't have to stitch all HTML content into a single unreadable JSON line)."),(0,r.kt)("p",null,"Attributes that support HTML insertions are the same ones that support tokens"),(0,r.kt)("p",null,"Example in ",(0,r.kt)("inlineCode",{parentName:"p"},"unit_config.json"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  ...\n  "instruction": "insertions/some_content.html"\n  ...\n}\n')),(0,r.kt)("h4",{id:"insertion-via-token"},"Insertion via token"),(0,r.kt)("p",null,"Use an extrapolated token as usual, and set that token's value to the insertion file's path.\nUpon extrapolation, value of such token will be automatically replaced with content of the HTML file."),(0,r.kt)("p",null,"Example in ",(0,r.kt)("inlineCode",{parentName:"p"},"token_sets_values_config.json"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "tokens_values": {\n      "some_long_content": "insertions/long_content.html"\n    }\n  }\n]\n')),(0,r.kt)("p",null,"Then embed this token into ",(0,r.kt)("inlineCode",{parentName:"p"},"unit_config.json"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  ...\n  "instruction": "Please see the below instructions: {{some_long_content}}"\n  ...\n}\n')),(0,r.kt)("h2",{id:"js-validator-insertion"},"JS validator insertion"),(0,r.kt)("p",null,"You can define your own custom field validator as a Javascript function, and place it in a special file ",(0,r.kt)("inlineCode",{parentName:"p"},"insertions/custom_validators.js")," inside your form config directory.\nWhen a Task is rendered in the browser, your validator function (let's call it ",(0,r.kt)("inlineCode",{parentName:"p"},"myValidator"),") will be imported from this file."),(0,r.kt)("p",null,'In form config, the validator function is associated with a field by adding this key-value pair under "validators" attribute:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'"myValidator": myValidatorArgument\n')),(0,r.kt)("p",null,"In your custom code, each validator function must have the following signature:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Accept 2 required arguments ",(0,r.kt)("inlineCode",{parentName:"li"},"field")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"value"),", and extra arguments as needed",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"field")," is a JS object representing a rendered form field"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"value")," is provided value of the field (format depends on the field type)"),(0,r.kt)("li",{parentName:"ul"},"Extra arguments will be passed after the ",(0,r.kt)("inlineCode",{parentName:"li"},"value")," argument (they come from the ",(0,r.kt)("inlineCode",{parentName:"li"},"myValidatorArgument")," value you specified in the form config under ",(0,r.kt)("inlineCode",{parentName:"li"},'"myValidator"')," key) :",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"If the value is a non-Array (Boolean, String, Number, or non-array Object), it will be passed as-is"),(0,r.kt)("li",{parentName:"ul"},"If the value is an Array, the content of Array will be decostructed and passed as separate positional arguments."))))),(0,r.kt)("li",{parentName:"ul"},"Return value must be either:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"null")," if validation passed successfully"),(0,r.kt)("li",{parentName:"ul"},"String if validation failed",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"This value will be shown to user as an error message underneath the field, and in the error summary block")))))),(0,r.kt)("p",null,"Example in ",(0,r.kt)("inlineCode",{parentName:"p"},"custom_validators.js"),"..."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'// You can import some functions from another file\nimport { someHelper } from "./helpers.js";\n\nexport function fieldContainsWord(field, value, word) {\n  someHelper();\n\n  if (value.includes(word)) {\n    return null;\n  }\n\n  return `Field ${field.name} must contain a word "${word}".`;\n}\n\n// This way you can separate all your validators into separate files, for convenience\nexport { phoneValidatorFunction } from "./phone_validator_code.js";\n')),(0,r.kt)("p",null,"...and its usage in ",(0,r.kt)("inlineCode",{parentName:"p"},"unit_config.json"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  ...\n  "validators": {\n    "required": true,\n    ...\n    "fieldContainsWord": "Mephisto"\n  },\n  ...\n}\n')),(0,r.kt)("h2",{id:"js-trigger-insertion"},"JS trigger insertion"),(0,r.kt)("p",null,"You can define your own custom trigger for a specific form element as a Javascript function, and place it in a special file ",(0,r.kt)("inlineCode",{parentName:"p"},"insertions/custom_triggers.js")," inside your form config directory.\nWhen a Task is rendered in the browser, your validator function (let's call it ",(0,r.kt)("inlineCode",{parentName:"p"},"myTrigger"),") will be imported from this file.\nNOTE: triggers are called synchronously in the current implementation and your code inside trigger funtion must be synchronous too."),(0,r.kt)("p",null,'In form config, the trigger function is associated with an element by adding this key-value pair under "triggers" attribute:'),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'"myTrigger": [myTriggerEventType, myTriggerArgument]\n')),(0,r.kt)("p",null,"In your custom code, each trigger function must have the following signature:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Accept 4 required arguments ",(0,r.kt)("inlineCode",{parentName:"li"},"formData"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"updateFormData"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"element"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"fieldValue"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"formFields"),", and extra arguments as needed",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"formData")," is a React state with form data (",(0,r.kt)("inlineCode",{parentName:"li"},"{<fieldName>: <fieldValue>, ...}"),")",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"This allows to lookup values of any form field by its ",(0,r.kt)("inlineCode",{parentName:"li"},'"name"')," attribute"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"updateFormData")," is a callback that sets value of any form field in the React state",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"This allows to change values of any form field by its ",(0,r.kt)("inlineCode",{parentName:"li"},'"name"')," attribute, e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},'updateFormData("name_first", "Austin")'),". Note that you will need change HTML-field value as well."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"element"),' is the form object that fired the trigger (i.e. "field", "section" or "submit button" object defined in form config)'),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"fieldValue")," is the value of an element that fired the trigger, if it's a form field (otherwise it's null)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"formFields")," is an object containing all form fields as defined in 'unit_config.json' (otherwise it's null)"),(0,r.kt)("li",{parentName:"ul"},"Extra arguments will be passed after the ",(0,r.kt)("inlineCode",{parentName:"li"},"fieldValue")," argument (they come from the ",(0,r.kt)("inlineCode",{parentName:"li"},"myTriggerArgument")," value you specified in the form config under ",(0,r.kt)("inlineCode",{parentName:"li"},'"myTrigger"')," key) :",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"If the value is a non-Array (Boolean, String, Number, or non-array Object), it will be passed as-is"),(0,r.kt)("li",{parentName:"ul"},"If the value is an Array, the content of Array will be decostructed and passed as separate positional arguments.")))))),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"myTriggerEventType")," parameter can take one of the following values, depending on the type of trigger element:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"non-field elements:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onClick"')))),(0,r.kt)("li",{parentName:"ul"},'"field" element:',(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"checkbox")," field type:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onChange"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onClick"')," (triggered from any part of the entire field, not just the buttons)"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"file")," field type:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onChange"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onBlur"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onFocus"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onClick"')))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"input")," field type:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onChange"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onBlur"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onFocus"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onClick"')))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"radio")," field type:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onChange"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onClick"')," (triggered from any part of the entire field, not just the buttons)"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"select")," field type:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onChange"')))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"textarea")," field type:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onChange"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onBlur"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onFocus"')),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},'"onClick"'))))))),(0,r.kt)("p",null,"Example in ",(0,r.kt)("inlineCode",{parentName:"p"},"custom_triggers.js"),"..."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},'export function onClickSectionHeader(\n  formData, // React state for the entire form\n  updateFormData, // callback to set the React state\n  element, // "field", "section", or "submit button" element that invoked this trigger\n  fieldValue, // (optional) current field value, if the `element` is a form field\n  formFields, // (optional) Object containing all form fields as defined in \'unit_config.json\'\n  sectionName // Argument for this trigger (taken from form config)\n) {\n  alert(`${sectionName} section was clicked!`);\n}\n')),(0,r.kt)("p",null,"...and its usage in ",(0,r.kt)("inlineCode",{parentName:"p"},"unit_config.json"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'{\n  ...,\n  "triggers": {\n    "onChange": ["onChangeName", [true, {"prefix": "_"}, 100]]\n  }\n  ...\n  "triggers": {\n    "onClick": ["onClickSectionHeader", "Triggerable"]\n  }\n  ...\n}\n')),(0,r.kt)("h4",{id:"js-trigger-helpers"},"JS trigger helpers"),(0,r.kt)("p",null,"During development of your form config, you can use a few available helper functions."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"validateFieldValue")," - checks whether you're assigning a valid value to a field\n(in case you want to change them programmatically)."),(0,r.kt)("p",{parentName:"li"},"  Example of use:")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add ",(0,r.kt)("inlineCode",{parentName:"p"},"mephisto-task-addons")," in webpack config"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},'resolve: {\n  alias: {\n    ...\n    "mephisto-task-addons": path.resolve(\n      __dirname,\n      "<relativePath>/packages/mephisto-task-addons"\n    ),\n  },\n}\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add import"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},'import { validateFieldValue } from "mephisto-task-addons";\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Validate a value before assigning it to form field"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},'const valueIsValid = validateFieldValue(formFields.languageRadioSelector, {"en": true, "fr": false}, true);\n')))),(0,r.kt)("h2",{id:"css-styles-insertions"},"CSS styles insertions"),(0,r.kt)("p",null,"To customize UI appearance, and separate CSS styles from your HTML insertions,\nyou can create multiple CSS files in the ",(0,r.kt)("inlineCode",{parentName:"p"},"insertions")," directory.\nThe only naming requirement is that their filenames should end with ",(0,r.kt)("inlineCode",{parentName:"p"},".css")," extension.\nThese CSS files will be automatically included in FormComposer UI via webpack build."),(0,r.kt)("p",null,"You can use CSS insertions to customize not only your HTML insertions pieces,\nbut also the standard Bootstrap form components themselves. There's two ways to do so:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"override existing styles (use CSS selectors for existing classes, names, ids, etc)"),(0,r.kt)("li",{parentName:"ul"},"add your own styles, and link them to ids and classes of form components (via their ",(0,r.kt)("inlineCode",{parentName:"li"},"id")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"classes")," config attributes - see ",(0,r.kt)("a",{parentName:"li",href:"/docs/guides/how_to_use/form_composer/configuration/config_files/"},"Config files reference"),")")))}c.isMDXComponent=!0}}]);