"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[907],{5110:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return d}});var a=n(9703);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),h=p(n),d=i,k=h["".concat(l,".").concat(d)]||h[d]||c[d]||o;return n?a.createElement(k,r(r({ref:t},u),{},{components:n})):a.createElement(k,r({ref:t},u))}));function d(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,r[1]=s;for(var p=2;p<o;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},5917:function(e,t,n){n.r(t),n.d(t,{contentTitle:function(){return l},default:function(){return h},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return u}});var a=n(2922),i=n(9230),o=(n(9703),n(5110)),r=["components"],s={sidebar_position:1},l="Running your first task",p={unversionedId:"guides/tutorials/first_task",id:"guides/tutorials/first_task",isDocsHomePage:!1,title:"Running your first task",description:"So you want to launch your first task. Thankfully Mephisto makes this fairly easy! We'll launch an HTML-based task as a way to get you started. This guide assumes you've worked through the quickstart, so begin there if you haven't.",source:"@site/docs/guides/tutorials/first_task.md",sourceDirName:"guides/tutorials",slug:"/guides/tutorials/first_task",permalink:"/docs/guides/tutorials/first_task",editUrl:"https://github.com/facebookresearch/Mephisto/tree/main/docs/web/docs/guides/tutorials/first_task.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"guides",previous:{title:"10-minute Quickstart",permalink:"/docs/guides/quickstart"},next:{title:"Working on a custom task",permalink:"/docs/guides/tutorials/custom_react"}},u=[{value:"1. Launching with default arguments",id:"1-launching-with-default-arguments",children:[{value:"1.1 Run the task",id:"11-run-the-task",children:[],level:3},{value:"1.2 Access the task",id:"12-access-the-task",children:[],level:3},{value:"1.3 Reviewing tasks",id:"13-reviewing-tasks",children:[],level:3}],level:2},{value:"2. Changing some defaults!",id:"2-changing-some-defaults",children:[{value:"2.1 Discovering options with <code>mephisto wut</code>",id:"21-discovering-options-with-mephisto-wut",children:[],level:3},{value:"2.2 Configuring options via the command line",id:"22-configuring-options-via-the-command-line",children:[],level:3},{value:"2.3 Using yaml configurations",id:"23-using-yaml-configurations",children:[],level:3},{value:"2.4 (optional) Launch live on MTurk sandbox",id:"24-optional-launch-live-on-mturk-sandbox",children:[],level:3}],level:2},{value:"3. Task breakdown",id:"3-task-breakdown",children:[{value:"3.1 Config registration",id:"31-config-registration",children:[],level:3},{value:"3.2 Invoking Mephisto",id:"32-invoking-mephisto",children:[],level:3},{value:"3.3 Default abstraction usage",id:"33-default-abstraction-usage",children:[],level:3},{value:"3.4 <code>Unit</code> creation explained",id:"34-unit-creation-explained",children:[],level:3},{value:"3.5 HTML static tasks in general",id:"35-html-static-tasks-in-general",children:[],level:3}],level:2}],c={toc:u};function h(e){var t=e.components,n=(0,i.Z)(e,r);return(0,o.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"running-your-first-task"},"Running your first task"),(0,o.kt)("p",null,"So you want to launch your first task. Thankfully Mephisto makes this fairly easy! We'll launch an HTML-based task as a way to get you started. This guide assumes you've worked through ",(0,o.kt)("a",{parentName:"p",href:"../../quickstart"},"the quickstart"),", so begin there if you haven't."),(0,o.kt)("h2",{id:"1-launching-with-default-arguments"},"1. Launching with default arguments"),(0,o.kt)("h3",{id:"11-run-the-task"},"1.1 Run the task"),(0,o.kt)("p",null,"To get started, you can launch a task by executing a run script. For instance, let's try the simple static HTML task:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ cd examples/simple_static_task\n$ python static_test_script.py\n")),(0,o.kt)("p",null,"This will launch a local HTTP server with the task hosted, based on the default configuration options:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"# hydra_configs/conf/example.yaml\ndefaults:\n  - /mephisto/blueprint: static_task\n  - /mephisto/architect: local\n  - /mephisto/provider: mock\n")),(0,o.kt)("p",null,"We'll dig into ",(0,o.kt)("em",{parentName:"p"},"how")," this works ",(0,o.kt)("a",{parentName:"p",href:"#33-default-abstraction-usage"},"later"),". "),(0,o.kt)("h3",{id:"12-access-the-task"},"1.2 Access the task"),(0,o.kt)("p",null,"By default, the task should be hosted at ",(0,o.kt)("inlineCode",{parentName:"p"},"localhost:3000"),". This default is set by the ",(0,o.kt)("inlineCode",{parentName:"p"},"LocalArchitect"),", which is used based on the ",(0,o.kt)("inlineCode",{parentName:"p"},"- /mephisto/architect: local")," line above. Navigating to this address should show you the preview view for the task."),(0,o.kt)("p",null,"Actually being able to access this task is done by providing ",(0,o.kt)("inlineCode",{parentName:"p"},"worker_id")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"assignment_id")," URL params, like ",(0,o.kt)("inlineCode",{parentName:"p"},"localhost:3000/?worker_id=x&assignment_id=1")," The ",(0,o.kt)("inlineCode",{parentName:"p"},"MockProvider")," interprets these to be a test worker, which you can use to try out tasks. "),(0,o.kt)("p",null,"Try navigating here and completing a task by selecting a value (no need to use the file upload). After hitting submit you'll note that the window alerts you to the data that was sent to the Mephisto backend."),(0,o.kt)("p",null,"To work on another task, you'll want to change the ",(0,o.kt)("inlineCode",{parentName:"p"},"assignment_id")," in your url. This will let ",(0,o.kt)("inlineCode",{parentName:"p"},"Worker"),' "x" work on another task. Complete and submit this too.'),(0,o.kt)("p",null,"If you try to work on another task, you'll note that the system states you've worked on the maximum number of tasks. On this task, this is because Mephisto has launched the same two tasks twice to attempt to get different workers to complete them, and as \"x\" you've already completed both tasks. More on this ",(0,o.kt)("a",{parentName:"p",href:"#unit-creation-explained"},"later.")),(0,o.kt)("p",null,"If you change to another ",(0,o.kt)("inlineCode",{parentName:"p"},"worker_id"),", however, you can complete two more tasks. Do this and the Mephisto process should shut down cleanly. "),(0,o.kt)("h3",{id:"13-reviewing-tasks"},"1.3 Reviewing tasks"),(0,o.kt)("p",null,"At this stage, we've collected data, and we'd like to review it. Here we'll do so with the command line interface, using the review script, which is in the same directory:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ python examine_results.py\nDo you want to (r)eview, or (e)xamine data? Default examine. Can put e <end> or e <start> <end> to choose how many to view\n>> r\nInput task name: \n")),(0,o.kt)("p",null,"Here we can enter the default task name for this task, ",(0,o.kt)("inlineCode",{parentName:"p"},"html-static-task-example")," to see the results. You can also leave the two qualifications blank, as we aren't dealing with these yet."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Input task name: html-static-task-example\nIf you'd like to soft-block workers, you'll need a block qualification. Leave blank otherwise.\nEnter block qualification: \nIf you'd like to qualify high-quality workers, you'll need an approve qualification. Leave blank otherwise.\nEnter approve qualification: \nStarting review with following params:\nTask name: html-static-task-example\nBlocking qualification: None\nApprove qualification: None\nPress enter to continue... \n")),(0,o.kt)("p",null,"After pressing enter, you'll be able to take action on some of the incoming tasks. You can ",(0,o.kt)("inlineCode",{parentName:"p"},"(a)ccept, (r)eject, (p)ass")," using ",(0,o.kt)("inlineCode",{parentName:"p"},"a"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"r"),", or ",(0,o.kt)("inlineCode",{parentName:"p"},"p"),", using the caps version to apply to all the ",(0,o.kt)("inlineCode",{parentName:"p"},"Unit"),"s for a specific worker. Passing is used for work you think was attempted legitimately, but may have not been done "),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"Reviewing for worker x, (1/2), Previous (First time worker!) (total remaining: 4)\n-------------------\nWorker: x\nUnit: 4455\nDuration: 288\nStatus: completed\nCharacter: Loaded Character 1\nDescription: I'm a character loaded from Mephisto!\n   Rating: passable\n   Files: []\n   File directory ...\n")),(0,o.kt)("p",null,"Review all four tasks (two from each of your test workers), and the script will close. Congrats on finishing your first complete batch!"),(0,o.kt)("h2",{id:"2-changing-some-defaults"},"2. Changing some defaults!"),(0,o.kt)("p",null,"Mephisto uses ",(0,o.kt)("a",{parentName:"p",href:"https://hydra.cc/"},"Hydra")," for our task configuration. As such you can use any of the Hydra methods for configuration. Of course, to configure you have to know your options."),(0,o.kt)("h3",{id:"21-discovering-options-with-mephisto-wut"},"2.1 Discovering options with ",(0,o.kt)("inlineCode",{parentName:"h3"},"mephisto wut")),(0,o.kt)("p",null,"Mephisto configuration options can be inherited from a number of different locations, so it can be difficult to track down all available arguments on your own. We provide the ",(0,o.kt)("inlineCode",{parentName:"p"},"mephisto wut")," cli tool to make this process simpler. For instance, knowing that we're launching a ",(0,o.kt)("inlineCode",{parentName:"p"},"static_task")," with the ",(0,o.kt)("inlineCode",{parentName:"p"},"local")," architect (as we saw ",(0,o.kt)("a",{parentName:"p",href:"#11-run-the-task"},"here"),"), we can examine these for configuration options."),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"For the architect:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ mephisto wut architect=local\n\ndest                type    default    help                                    choices    required\n------------------  ------  ---------  --------------------------------------  ---------  ----------\nserver_type         str     node       None                                    None       False\nserver_source_path  str     ???        Optional path to a prepared server      None       False\n                                       directory containing everything needed\n                                       to run a server of the given type.\n                                       Overrides server type.\nhostname            str     localhost  Addressible location of the server      None       False\nport                str     3000       Port to launch the server on            None       False\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"For the blueprint:")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ mephisto wut blueprint=static_task\nTasks launched from static blueprints need a source html file to display to workers, as well as a csv containing values that will be inserted into templates in the html. \ndest                      type     default    help                                      choices    required\n------------------------  -------  ---------  ----------------------------------------  ---------  ----------\nblock_qualification       str      ???        Specify the name of a qualification used  None       False\n                                              to soft block workers.\nonboarding_qualification  str      ???        Specify the name of a qualification used  None       False\n                                              to block workers who fail onboarding,\n                                              Empty will skip onboarding.\nunits_per_assignment      int      1          How many workers you want to do each      None       False\n                                              assignment\nextra_source_dir          str      ???        Optional path to sources that the HTML    None       False\n                                              may refer to (such as\n                                              images/video/css/scripts)\ndata_json                 str      ???        Path to JSON file containing task data    None       False\ndata_jsonl                str      ???        Path to JSON-L file containing task data  None       False\ndata_csv                  str      ???        Path to csv file containing task data     None       False\ntask_source               str      ???        Path to source HTML file for the task     None       True\n                                              being run\npreview_source            unknown  ???        Optional path to source HTML file to      None       False\n                                              preview the task\nonboarding_source         unknown  ???        Optional path to source HTML file to      None       False\n                                              onboarding the task\nAdditional SharedTaskState args from SharedStaticTaskState\n# ... snipped ...\n")),(0,o.kt)("p",null,"For our given example task, the values we are using for these options are available in the ",(0,o.kt)("inlineCode",{parentName:"p"},"hydra_configs/conf/example.yaml")," file. Let's try overriding some defaults."),(0,o.kt)("h3",{id:"22-configuring-options-via-the-command-line"},"2.2 Configuring options via the command line"),(0,o.kt)("p",null,"As a simple starting point, we can try launching the server on a different port. Right now the default is ",(0,o.kt)("inlineCode",{parentName:"p"},"3000"),", but with the following command we can set that ourselves:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"python static_test_script.py mephisto.architect.port=1234\n")),(0,o.kt)("p",null,"This should launch the same task, but now available on the port ",(0,o.kt)("inlineCode",{parentName:"p"},"1234")," rather than ",(0,o.kt)("inlineCode",{parentName:"p"},"3000"),"."),(0,o.kt)("p",null,"Once we see the task is running, we can shut down with ",(0,o.kt)("inlineCode",{parentName:"p"},"Ctrl-C"),"."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Tip:")," Shutting down Mephisto via a single ",(0,o.kt)("inlineCode",{parentName:"p"},"Ctrl-C")," interrupt ",(0,o.kt)("em",{parentName:"p"},"attempts")," to cleanup everything, but sometimes takes time for cleanup steps. You can skip some steps with additional ",(0,o.kt)("inlineCode",{parentName:"p"},"Ctrl-C")," presses, but then you'll need to clean up resources yourself.")),(0,o.kt)("h3",{id:"23-using-yaml-configurations"},"2.3 Using yaml configurations"),(0,o.kt)("p",null,"While it makes sense to update some parameters on the command line while iterating, generally it's easier to extend the ",(0,o.kt)("inlineCode",{parentName:"p"},"conf")," files directly, then apply all of the options by overriding ",(0,o.kt)("inlineCode",{parentName:"p"},"conf"),". Try copying the ",(0,o.kt)("inlineCode",{parentName:"p"},"hydra_configs/conf/example.yaml")," file into ",(0,o.kt)("inlineCode",{parentName:"p"},"hydra_configs/conf/my_config.yaml"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'#hydra_configs/conf/my_config.yaml\n\n#@package _global_\ndefaults:\n  - /mephisto/blueprint: static_task\n  - /mephisto/architect: local\n  - /mephisto/provider: mock\nmephisto:\n  blueprint:\n    data_csv: ${task_dir}/data_tutorial.csv    # Lets use the tutorial data\n    task_source: ${task_dir}/server_files/demo_task.html\n    preview_source: ${task_dir}/server_files/demo_preview.html\n    extra_source_dir: ${task_dir}/server_files/extra_refs\n    units_per_assignment: 1   # And only one unit per assignment, as we\'re testing as one worker\n  task:\n    task_name: first-task-tutorial-run  # Let\'s change the task name\n    task_title: "Test static task"\n    task_description: "This is a simple test of static tasks."\n    task_reward: 0.3\n    task_tags: "static,task,testing"\n')),(0,o.kt)("p",null,"Save this configuration file, and you're ready to launch again:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ python static_test_script conf=my_config\n")),(0,o.kt)("p",null,"You'll note that Mephisto launches the task under your new task name:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[...][...][INFO] - Creating a task run under task name: first-task-tutorial-run\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"A note on ",(0,o.kt)("inlineCode",{parentName:"strong"},"task_name"),"s:"),"\nThe ",(0,o.kt)("inlineCode",{parentName:"p"},"task_name")," parameter is particularly important for setting up workflows. Many of Mephisto's features are shared under a specific ",(0,o.kt)("inlineCode",{parentName:"p"},"task_name")," namespace, including review flows and unit completion maximums per worker per namespace. Later ",(0,o.kt)("a",{parentName:"p",href:"../workflows"},"guides")," go more in-depth on best practices.")),(0,o.kt)("p",null,"Navigating to a task (",(0,o.kt)("inlineCode",{parentName:"p"},"localhost:3000/?worker_id=x&assignment_id=1"),") should now show you a task loaded from a different data file. Completing this task will lead Mephisto to shut down cleanly."),(0,o.kt)("p",null,"You can now review this task with the review script again, this time providing the task name ",(0,o.kt)("inlineCode",{parentName:"p"},"first-task-tutorial-run"),"."),(0,o.kt)("h3",{id:"24-optional-launch-live-on-mturk-sandbox"},"2.4 (optional) Launch live on MTurk sandbox"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"Note: The Mephisto process must remain running when in-use, so you must leave your machine running to be able to access a task.")),(0,o.kt)("p",null,"You don't need to do this step ",(0,o.kt)("em",{parentName:"p"},"right now"),", however it's important for understanding how to take one of these tasks live. Assuming you've completed the optional steps in ",(0,o.kt)("a",{parentName:"p",href:"../../quickstart#optional-set-up-mturk"},"the quickstart"),", you can make the following changes to your config file, replacing ",(0,o.kt)("inlineCode",{parentName:"p"},"my_mturk_user_sandbox")," with the id you used in it's place when registering initially:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},'#hydra_configs/conf/my_config.yaml\n\n#@package _global_\ndefaults:\n  - /mephisto/blueprint: static_task\n  - /mephisto/architect: heroku   # To launch live, we\'ll need an external server\n  - /mephisto/provider: mturk_sandbox  # And an external provider\nmephisto:\n  provider:\n    requester_name: my_mturk_user_sandbox # Or whatever ID you provided with `mephisto register mturk_sandbox`\n  blueprint:\n    data_csv: ${task_dir}/data_tutorial.csv\n    task_source: ${task_dir}/server_files/demo_task.html\n    preview_source: ${task_dir}/server_files/demo_preview.html\n    extra_source_dir: ${task_dir}/server_files/extra_refs\n    units_per_assignment: 1\n  task:\n    task_name: first-task-tutorial-run\n    task_title: "Test static task"\n    task_description: "This is a simple test of static tasks."\n    task_reward: 0.3\n    task_tags: "static,task,testing"\n')),(0,o.kt)("p",null,"Save this configuration file, and you're ready to see your task live:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"$ python static_test_script conf=my_config\n")),(0,o.kt)("p",null,"Mephisto should print out a link to view your task on the mturk sandbox, like ",(0,o.kt)("inlineCode",{parentName:"p"},"https://workersandbox.mturk.com/mturk/preview?groupId=XXXXXXXXXXXXXXXX"),". Navigate here and you're working on the same task, available on MTurk (on the sandbox at least)!"),(0,o.kt)("p",null,"Complete this task, and you can review it in the same way as before."),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Tip"),": You can reuse common configurations by ",(0,o.kt)("a",{parentName:"p",href:"../../how_to_use/efficiency_organization/reusing_configs"},"associating them with a profile"),". Usually these contain ",(0,o.kt)("inlineCode",{parentName:"p"},"Provider")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"Architect")," arguments, as these usually aren't related to a specific task.")),(0,o.kt)("h2",{id:"3-task-breakdown"},"3. Task breakdown"),(0,o.kt)("p",null,"Now that you've gotten a task running, this section gives a quick overview on some of the components in the configs and ",(0,o.kt)("inlineCode",{parentName:"p"},"static_test_script.py")," that led to the observed behaviors. The goal is to ensure you can write your own run files by the end of the tutorial sections."),(0,o.kt)("h3",{id:"31-config-registration"},"3.1 Config registration"),(0,o.kt)("p",null,"Mephisto wires up to configuration using standard Hydra syntax, but with both ",(0,o.kt)("inlineCode",{parentName:"p"},"yaml")," files (for ease of writing) ",(0,o.kt)("em",{parentName:"p"},"and")," structured configs (for ease of documentation).\nHere's the config we've set up for this example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},'# static_test_script.py\nfrom mephisto.abstractions.blueprints.static_html_task.static_html_blueprint import (\n    BLUEPRINT_TYPE_STATIC_HTML,\n)\nfrom mephisto.tools.scripts import task_script\nfrom omegaconf import DictConfig\n\n@task_script(default_config_file="example")\ndef main(operator: Operator, cfg: DictConfig) -> None:\n')),(0,o.kt)("p",null,"This is all you really ",(0,o.kt)("em",{parentName:"p"},"need")," to launch a Mephisto task! The ",(0,o.kt)("inlineCode",{parentName:"p"},"@task_script")," decorator does the job of attaching your hydra yaml as default arguments for the main."),(0,o.kt)("p",null,"Of course, there's quite a bit of 'magic' happening underneath the hood thanks to the script utilities. This version is explicit to show where you may add customization, and re-ordered for understanding:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"# modified static_test_script.py\nfrom mephisto.abstractions.blueprints.static_html_task.static_html_blueprint import (\n    BLUEPRINT_TYPE_STATIC_HTML,\n)\n\nfrom mephisto.tools.scripts import task_script\nfrom mephisto.operations.hydra_config import build_default_task_config\n\n@dataclass\nclass MyTaskConfig(build_default_task_config('example')):\n    custom_args: Any = 4\n\n@task_script(config=MyTaskConfig)\ndef main(operator: Operator, cfg: DictConfig) -> None:\n")),(0,o.kt)("p",null,"In this snippet, we do a few things:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"We import the ",(0,o.kt)("inlineCode",{parentName:"li"},"BLUEPRINT_TYPE_STATIC_HTML")," to force an import of the blueprint we intend to use with this run script (making the ",(0,o.kt)("inlineCode",{parentName:"li"},"register_mephisto_abstraction")," call). This isn't ",(0,o.kt)("em",{parentName:"li"},"required")," for any of Mephisto's default blueprints, but would be necessary for use with custom ",(0,o.kt)("inlineCode",{parentName:"li"},"Blueprint"),"s not in the ",(0,o.kt)("inlineCode",{parentName:"li"},"mephisto/abstractions/blueprints")," folder."),(0,o.kt)("li",{parentName:"ol"},"We set up the default ",(0,o.kt)("a",{parentName:"li",href:"https://hydra.cc/docs/tutorials/basic/your_first_app/config_file/"},(0,o.kt)("inlineCode",{parentName:"a"},"conf"))," file to be ",(0,o.kt)("inlineCode",{parentName:"li"},"example"),", using ",(0,o.kt)("inlineCode",{parentName:"li"},"build_default_task_config"),", which returns a ",(0,o.kt)("inlineCode",{parentName:"li"},"TaskConfig")," that we can extend."),(0,o.kt)("li",{parentName:"ol"},"We extend the returned ",(0,o.kt)("inlineCode",{parentName:"li"},"TaskConfig")," with ",(0,o.kt)("inlineCode",{parentName:"li"},"MyTaskConfig"),", which allows us to specify custom arguments."),(0,o.kt)("li",{parentName:"ol"},"We decorate the main, noting that the correct config is ",(0,o.kt)("inlineCode",{parentName:"li"},"MyTaskConfig"),". Note that the ",(0,o.kt)("inlineCode",{parentName:"li"},"default_config_file")," version of this simply takes care of the above steps inline in the decorator.")),(0,o.kt)("p",null,"With all the above, we're able to just make edits to ",(0,o.kt)("inlineCode",{parentName:"p"},"example.yaml")," or make other configs in the ",(0,o.kt)("inlineCode",{parentName:"p"},"conf/")," directory and route to them directly."),(0,o.kt)("h3",{id:"32-invoking-mephisto"},"3.2 Invoking Mephisto"),(0,o.kt)("p",null,"Mephisto itself is actually invoked just a little later:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-python"},"def main(operator: Operator, cfg: DictConfig) -> None:\n    operator.launch_task_run(cfg.mephisto)\n    operator.wait_for_runs_then_shutdown(skip_input=True, log_rate=30)\n")),(0,o.kt)("p",null,"Under the hood the ",(0,o.kt)("inlineCode",{parentName:"p"},"task_script")," decorator extracts specific arguments out of your configuration (and surface warnings about incompatibilities) and initializes an ",(0,o.kt)("inlineCode",{parentName:"p"},"Operator")," on the correct ",(0,o.kt)("inlineCode",{parentName:"p"},"MephistoDB")," for the task. Using this we can launch a ",(0,o.kt)("inlineCode",{parentName:"p"},"TaskRun")," the given config, then wait for it to run. To ensure we're not frozen, the operator takes in a ",(0,o.kt)("inlineCode",{parentName:"p"},"log_rate")," in seconds to print status messages while the run is underway."),(0,o.kt)("h3",{id:"33-default-abstraction-usage"},"3.3 Default abstraction usage"),(0,o.kt)("p",null,"Again we can look back at the ",(0,o.kt)("inlineCode",{parentName:"p"},"example.yaml")," file to see this setup:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"# hydra_configs/conf/example.yaml\ndefaults:\n  - /mephisto/blueprint: static_task\n  - /mephisto/architect: local\n  - /mephisto/provider: mock\n")),(0,o.kt)("p",null,"These ensure that, when not provided other arguments, we launch this task locally using a ",(0,o.kt)("inlineCode",{parentName:"p"},"LocalArchitect")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"MockProvider"),'. With these defaults, this and other example tasks are run using a "local" architect, and a "mock" requester without arguments. The "local" architect is reponsible for running a server on your local machine to host the task, and the "mock" requester lets ',(0,o.kt)("em",{parentName:"p"},"you")," simulate a worker without using an external crowd-provider platform such as mTurk to launch the task."),(0,o.kt)("h3",{id:"34-unit-creation-explained"},"3.4 ",(0,o.kt)("inlineCode",{parentName:"h3"},"Unit")," creation explained"),(0,o.kt)("p",null,"When stepping through this task the first time, you ended up working on four ",(0,o.kt)("inlineCode",{parentName:"p"},"Unit"),"s as two different ",(0,o.kt)("inlineCode",{parentName:"p"},"Worker"),"s. It's useful to understand how this happens. Taking a look at the config and data:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"# hydra_configs/conf/example.yaml\n\n#@package _global_\ndefaults:\n...\nmephisto:\n  ...\n  blueprint:\n    data_csv: ${task_dir}/data.csv\n    ...\n    units_per_assignment: 2\n  task:\n    ...\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"# data.csv\ncharacter_name,character_description\nLoaded Character 1,I'm a character loaded from Mephisto!\nLoaded Character 2,I'm another character loaded from Mephisto!\n")),(0,o.kt)("p",null,"From this, we know we're loading from ",(0,o.kt)("inlineCode",{parentName:"p"},"data.csv"),", and that this file only has two listed items. Mephisto creates an ",(0,o.kt)("inlineCode",{parentName:"p"},"Assignment")," for each of these lines, representing a group of work for which a worker can only contribute to once. We also specify two ",(0,o.kt)("inlineCode",{parentName:"p"},"units_per_assignment"),", meaning that Mephisto creates two ",(0,o.kt)("inlineCode",{parentName:"p"},"Unit"),"s per ",(0,o.kt)("inlineCode",{parentName:"p"},"Assignment"),", meaning in this static case that different workers can complete the same job, usually to get inter-annotator agreement. (In some cases Mephisto can use an ",(0,o.kt)("inlineCode",{parentName:"p"},"Assignment")," to connect multiple workers each with one ",(0,o.kt)("inlineCode",{parentName:"p"},"Unit")," on a collaborative live task). As we had two assignments, it makes sense that each worker ",(0,o.kt)("inlineCode",{parentName:"p"},"x")," and your second worker could only complete two tasks each."),(0,o.kt)("p",null,"On the second launch, we had a file with only one entry and set ",(0,o.kt)("inlineCode",{parentName:"p"},"units_per_assignment")," to 1, which ensured that there was only a single ",(0,o.kt)("inlineCode",{parentName:"p"},"Unit")," that needed to be completed before Mephisto shut down."),(0,o.kt)("h3",{id:"35-html-static-tasks-in-general"},"3.5 HTML static tasks in general"),(0,o.kt)("p",null,"You can use HTML static tasks to render simple annotation with custom HTML code. They may act as a good starting point for working on the platform, however they aren't the easiest or most powerful way to use Mephisto.  More details can be found on how to customize these tasks ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/facebookresearch/Mephisto/tree/main/mephisto/abstractions/blueprints/static_html_task"},"here"),", though the rest of the tutorials will focus on React-based tasks. You can build your first in the ",(0,o.kt)("a",{parentName:"p",href:"../custom_react"},"next tutorial"),"."))}h.isMDXComponent=!0},2922:function(e,t,n){function a(){return a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},a.apply(this,arguments)}n.d(t,{Z:function(){return a}})},9230:function(e,t,n){function a(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}n.d(t,{Z:function(){return a}})}}]);