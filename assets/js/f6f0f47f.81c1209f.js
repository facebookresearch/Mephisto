"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[9988],{4127:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return k}});var o=n(1987);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},i=Object.keys(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)n=i[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),m=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},u=function(e){var t=m(e.components);return o.createElement(s.Provider,{value:t},e.children)},p="mdxType",f={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},c=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=m(n),c=a,k=p["".concat(s,".").concat(c)]||p[c]||f[c]||i;return n?o.createElement(k,r(r({ref:t},u),{},{components:n})):o.createElement(k,r({ref:t},u))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:a,r[1]=l;for(var m=2;m<i;m++)r[m]=n[m];return o.createElement.apply(null,r)}return o.createElement.apply(null,n)}c.displayName="MDXCreateElement"},5346:function(e,t,n){n.r(t),n.d(t,{assets:function(){return u},contentTitle:function(){return s},default:function(){return c},frontMatter:function(){return l},metadata:function(){return m},toc:function(){return p}});var o=n(9375),a=n(8933),i=(n(1987),n(4127)),r=["components"],l={sidebar_position:2},s="Multiple form versions",m={unversionedId:"guides/how_to_use/form_composer/configuration/multiple_form_versions",id:"guides/how_to_use/form_composer/configuration/multiple_form_versions",title:"Multiple form versions",description:"The simplest Task scenario is showing the same exact form to all of your workers. In that case you need to:",source:"@site/docs/guides/how_to_use/form_composer/configuration/multiple_form_versions.md",sourceDirName:"guides/how_to_use/form_composer/configuration",slug:"/guides/how_to_use/form_composer/configuration/multiple_form_versions",permalink:"/docs/guides/how_to_use/form_composer/configuration/multiple_form_versions",draft:!1,editUrl:"https://github.com/facebookresearch/Mephisto/tree/main/docs/web/docs/guides/how_to_use/form_composer/configuration/multiple_form_versions.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"guides",previous:{title:"Config files reference",permalink:"/docs/guides/how_to_use/form_composer/configuration/config_files"},next:{title:"`form_composer_config` command",permalink:"/docs/guides/how_to_use/form_composer/configuration/form_composer_config_command"}},u={},p=[{value:"Custom form versions",id:"custom-form-versions",level:2},{value:"Dynamic form config",id:"dynamic-form-config",level:2},{value:"Tokens extrapolation",id:"tokens-extrapolation",level:4},{value:"Generate token sets with <code>--update-file-location-values</code>",id:"generate-token-sets-with---update-file-location-values",level:4},{value:"Generate separate token values with <code>--update-file-location-values</code>",id:"generate-separate-token-values-with---update-file-location-values",level:4},{value:"Mturk Task Preview",id:"mturk-task-preview",level:4},{value:"Dynamic form config example",id:"dynamic-form-config-example",level:2},{value:"Separate token values config",id:"separate-token-values-config",level:4},{value:"Token values config",id:"token-values-config",level:4},{value:"Form config",id:"form-config",level:4},{value:"Task data config",id:"task-data-config",level:4}],f={toc:p};function c(e){var t=e.components,n=(0,a.Z)(e,r);return(0,i.kt)("wrapper",(0,o.Z)({},f,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"multiple-form-versions"},"Multiple form versions"),(0,i.kt)("p",null,"The simplest Task scenario is showing the same exact form to all of your workers. In that case you need to:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Compose ",(0,i.kt)("inlineCode",{parentName:"li"},"task_data.json")," file containing definition of a single form (and place it into FormComposer config folder)"),(0,i.kt)("li",{parentName:"ul"},"Optionally, verify your config: ",(0,i.kt)("inlineCode",{parentName:"li"},"mephisto form_composer_config --verify")),(0,i.kt)("li",{parentName:"ul"},"Run FormComposer: ",(0,i.kt)("inlineCode",{parentName:"li"},"mephisto form_composer"))),(0,i.kt)("p",null,"But suppose you wish to show a slightly different version of the form to your workers. You can do so by defining multiple form versions. FormComposer provides several ways of doing so."),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"custom-form-versions"},"Custom form versions"),(0,i.kt)("p",null,"If your form versions vary considerably (e.g. showing different sets of fields), you should do the following steps:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Populate these form versions into ",(0,i.kt)("inlineCode",{parentName:"li"},"task_data.json")," file manually (it will be basically a JSON array of N individual form versions configs)"),(0,i.kt)("li",{parentName:"ul"},"Optionally, verify your config: ",(0,i.kt)("inlineCode",{parentName:"li"},"mephisto form_composer_config --verify")),(0,i.kt)("li",{parentName:"ul"},"Run FormComposer: ",(0,i.kt)("inlineCode",{parentName:"li"},"mephisto form_composer"))),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"As a result, for each Task assignment Mephisto will automatically produce N units, each unit having a different form version. In total you will be collecting data from ",(0,i.kt)("inlineCode",{parentName:"em"},"N * units_per_assignment")," workers.")),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"dynamic-form-config"},"Dynamic form config"),(0,i.kt)("p",null,"If your form versions vary only slightly (e.g. same set of fields, but showing different images or different text), you should use a dynamic form config as follows:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Ensure you populate these files, and place them into your FormComposer config folder:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"form_config.json"),": tokenized form config - same as regular form config, except it will contain tokens within certain objects' attributes (see ",(0,i.kt)("a",{parentName:"li",href:"#tokens-extrapolation"},"Tokens extrapolation"),")"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"token_sets_values_config.json"),": file containing sets of token values, where each set is used to generate one version of the form (and each form version will be completed by ",(0,i.kt)("inlineCode",{parentName:"li"},"units_per_assignment")," different workers)."))),(0,i.kt)("li",{parentName:"ul"},"Optionally, verify your files: ",(0,i.kt)("inlineCode",{parentName:"li"},"mephisto form_composer_config --verify")),(0,i.kt)("li",{parentName:"ul"},"Generate task data config: ",(0,i.kt)("inlineCode",{parentName:"li"},"mephisto form_composer_config --extrapolate-token-sets"),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"This will overwrite existing ",(0,i.kt)("inlineCode",{parentName:"li"},"task_data.json")," file with auto-generated form versions, by extrapolating provided token sets values"))),(0,i.kt)("li",{parentName:"ul"},"Run FormComposer: ",(0,i.kt)("inlineCode",{parentName:"li"},"mephisto form_composer"))),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},"The number of generated form versions N will be same as number of provided token sets. In total you will be collecting data from ",(0,i.kt)("inlineCode",{parentName:"em"},"N * units_per_assignment")," workers.")),(0,i.kt)("hr",null),(0,i.kt)("h4",{id:"tokens-extrapolation"},"Tokens extrapolation"),(0,i.kt)("p",null,"How does token extrapolation work?"),(0,i.kt)("p",null,'A token is a named text placeholder that gets replaced ("extrapolated") by values specified in ',(0,i.kt)("inlineCode",{parentName:"p"},"token_sets_values_config.json")," (each set of token values produces one form version based on dynamic form config ",(0,i.kt)("inlineCode",{parentName:"p"},"form_data.json"),")."),(0,i.kt)("p",null,"Token placeholders within an attribute are formatted like so: ",(0,i.kt)("inlineCode",{parentName:"p"},"{{TOKEN_NAME}}")),(0,i.kt)("p",null,"Tokens can be placed within the following object attributes:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"help")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"instruction")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"label")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"title")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"tooltip"))),(0,i.kt)("p",null,"If you wish to reuse the same token across different form attributes and levels, it's enough to specify it in a set of token values just once. (This also means that token names must be unique within token values sets)"),(0,i.kt)("hr",null),(0,i.kt)("h4",{id:"generate-token-sets-with---update-file-location-values"},"Generate token sets with ",(0,i.kt)("inlineCode",{parentName:"h4"},"--update-file-location-values")),(0,i.kt)("p",null,"In a special case when all of your tokens sets are simply permutations of several value lists, sets of token values can be easily auto-generated."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Populate your lists of values for every separate token into ",(0,i.kt)("inlineCode",{parentName:"li"},"separate_token_values_config.json")," file"),(0,i.kt)("li",{parentName:"ul"},"Optionally, verify your config: ",(0,i.kt)("inlineCode",{parentName:"li"},"mephisto form_composer_config --verify")),(0,i.kt)("li",{parentName:"ul"},"Generate ",(0,i.kt)("inlineCode",{parentName:"li"},"token_sets_values_config.json")," with command: ",(0,i.kt)("inlineCode",{parentName:"li"},"mephisto form_composer_config --permutate-separate-tokens"))),(0,i.kt)("p",null,(0,i.kt)("em",{parentName:"p"},'"Permutation" means all possible combinations of values. For example, permutations of amounts ',(0,i.kt)("inlineCode",{parentName:"em"},"2, 3"),", sizes ",(0,i.kt)("inlineCode",{parentName:"em"},"big")," and animals ",(0,i.kt)("inlineCode",{parentName:"em"},"cats, dogs")," will produce result ",(0,i.kt)("inlineCode",{parentName:"em"},"2 big cats, 2 big dogs, 3 big cats, 3 big dogs"),".")),(0,i.kt)("hr",null),(0,i.kt)("h4",{id:"generate-separate-token-values-with---update-file-location-values"},"Generate separate token values with ",(0,i.kt)("inlineCode",{parentName:"h4"},"--update-file-location-values")),(0,i.kt)("p",null,"In a special case when one of your tokens is an S3 file URL, that token values can be easily auto-generated."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Make a public S3 folder that will contain only the files that you want (all of them)"),(0,i.kt)("li",{parentName:"ul"},"Run command: ",(0,i.kt)("inlineCode",{parentName:"li"},"mephisto form_composer --update-file-location-values S3_FOLDER_URL")),(0,i.kt)("li",{parentName:"ul"},"As a result, a token with name ",(0,i.kt)("inlineCode",{parentName:"li"},'"file_location"')," will be added to your ",(0,i.kt)("inlineCode",{parentName:"li"},"separate_token_values_config.json")," config file. Its values will be S3 URLs of all files found .recursively within the ",(0,i.kt)("inlineCode",{parentName:"li"},"S3_FOLDER_URL"))),(0,i.kt)("hr",null),(0,i.kt)("h4",{id:"mturk-task-preview"},"Mturk Task Preview"),(0,i.kt)("p",null,"For Tasks run with Mechanical Turk provider, FormComposer generates a Task preview (a small HTML snippet shown to worker prior to starting the task). This Task review comprises HTML content of ",(0,i.kt)("inlineCode",{parentName:"p"},"form")," object's attributes ",(0,i.kt)("inlineCode",{parentName:"p"},"title")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"instruction"),"."),(0,i.kt)("p",null,"However, note that the task preview is inherently static, therefore:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"we always take the first form version in ",(0,i.kt)("inlineCode",{parentName:"li"},"data_task.json")," to generate Task preview for all form versions"),(0,i.kt)("li",{parentName:"ul"},"we erase dynamic tokens from the Task review content")),(0,i.kt)("hr",null),(0,i.kt)("h2",{id:"dynamic-form-config-example"},"Dynamic form config example"),(0,i.kt)("p",null,"Putting it altogether, this is a brief example of composing a dynamic form config."),(0,i.kt)("h4",{id:"separate-token-values-config"},"Separate token values config"),(0,i.kt)("p",null,"Let's start with separate token values in ",(0,i.kt)("inlineCode",{parentName:"p"},"separate_token_values_config.json")," file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "actor": ["Carrie Fisher", "Mark Hamill"],\n  "movie_name": ["Star Wars"]\n}\n')),(0,i.kt)("h4",{id:"token-values-config"},"Token values config"),(0,i.kt)("p",null,"Permutating these token values will produce this ",(0,i.kt)("inlineCode",{parentName:"p"},"form_config.json")," file with token sets values:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "tokens_values": {\n      "actor": "Carrie Fisher",\n      "movie_name": "Star Wars"\n    }\n  },\n  {\n    "tokens_values": {\n      "actor": "Mark Hamill",\n      "movie_name": "Star Wars"\n    }\n  },\n]\n')),(0,i.kt)("p",null,"Example of config after using ",(0,i.kt)("inlineCode",{parentName:"p"},'--update-file-location-values "https://s3.amazonaws.com/...." --use_presigned_urls')," params:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "tokens_values": {\n      "file_location": "{{getPresignedUrl(\\"https://s3.amazonaws.com/1.jpg\\")}}"\n    }\n  },\n  {\n    "tokens_values": {\n      "file_location": "{{getPresignedUrl(\\"https://s3.amazonaws.com/2.jpg\\")}}"\n    }\n  },\n]\n')),(0,i.kt)("h4",{id:"form-config"},"Form config"),(0,i.kt)("p",null,"These tokens are placed into the ",(0,i.kt)("inlineCode",{parentName:"p"},"form_config.json")," dynamic form config like so:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  ...\n  "instruction": "Rate {{actor}}\'s performance in movie <b>\'{{movie_name}}\'</b>",\n  ...\n  "help": "Please only consider the movie \'{{movie_name}}\'",\n  ...\n}\n...\n{\n  ...\n  "instruction": "Rate the plot in movie \'{{movie_name}}\' out of 10",\n  ...\n}\n')),(0,i.kt)("h4",{id:"task-data-config"},"Task data config"),(0,i.kt)("p",null,"After extrapolating attributes from ",(0,i.kt)("inlineCode",{parentName:"p"},"form_config.json")," with token sets from ",(0,i.kt)("inlineCode",{parentName:"p"},"token_sets_values_config.json"),", we get the resulting ",(0,i.kt)("inlineCode",{parentName:"p"},"task_data.json")," file used for the task:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'// First extrapolated form version\n{\n  ...\n  "instruction": "Rate Carrie Fisher\'s performance in movie <b>\'Star Wars\'</b>",\n  ...\n  "help": "Please only consider the movie \'Star Wars\'",\n  ...\n}\n...\n{\n  ...\n  "instruction": "Rate the plot in movie \'Star Wars\' out of 10?",\n  ...\n},\n// Second extrapolated form version\n{\n  ...\n  "instruction": "Rate Mark Hamill\'s performance in movie <b>\'Star Wars\'</b>",\n  ...\n  "help": "Please only consider the movie \'Star Wars\'",\n  ...\n}\n...\n{\n  ...\n  "instruction": "Rate the plot in movie \'Star Wars\' out of 10?",\n  ...\n}\n')))}c.isMDXComponent=!0}}]);