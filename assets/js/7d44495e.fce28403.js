"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[2908],{4127:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return k}});var i=n(1987);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=i.createContext({}),u=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=u(e.components);return i.createElement(s.Provider,{value:t},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},c=i.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=u(n),c=a,k=d["".concat(s,".").concat(c)]||d[c]||m[c]||o;return n?i.createElement(k,r(r({ref:t},p),{},{components:n})):i.createElement(k,r({ref:t},p))}));function k(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,r=new Array(o);r[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:a,r[1]=l;for(var u=2;u<o;u++)r[u]=n[u];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}c.displayName="MDXCreateElement"},3645:function(e,t,n){n.r(t),n.d(t,{assets:function(){return p},contentTitle:function(){return s},default:function(){return c},frontMatter:function(){return l},metadata:function(){return u},toc:function(){return d}});var i=n(9375),a=n(8933),o=(n(1987),n(4127)),r=["components"],l={sidebar_position:7},s="Using code insertions",u={unversionedId:"guides/how_to_use/video_annotator/configuration/insertions",id:"guides/how_to_use/video_annotator/configuration/insertions",title:"Using code insertions",description:"VideoAnnotator allows using custom code insertions in these scenarios:",source:"@site/docs/guides/how_to_use/video_annotator/configuration/insertions.md",sourceDirName:"guides/how_to_use/video_annotator/configuration",slug:"/guides/how_to_use/video_annotator/configuration/insertions",permalink:"/docs/guides/how_to_use/video_annotator/configuration/insertions",draft:!1,editUrl:"https://github.com/facebookresearch/Mephisto/tree/main/docs/web/docs/guides/how_to_use/video_annotator/configuration/insertions.md",tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7},sidebar:"guides",previous:{title:"Segment rendering callbacks",permalink:"/docs/guides/how_to_use/video_annotator/configuration/form_callbacks"},next:{title:"Embed VideoAnnotator into custom application",permalink:"/docs/guides/how_to_use/video_annotator/embedding"}},p={},d=[{value:"HTML content insertion",id:"html-content-insertion",level:2},{value:"Insertion without token",id:"insertion-without-token",level:4},{value:"Insertion via token",id:"insertion-via-token",level:4},{value:"JS validator insertion",id:"js-validator-insertion",level:2},{value:"JS trigger insertion",id:"js-trigger-insertion",level:2},{value:"JS trigger helpers",id:"js-trigger-helpers",level:4},{value:"CSS styles insertions",id:"css-styles-insertions",level:2}],m={toc:d};function c(e){var t=e.components,n=(0,a.Z)(e,r);return(0,o.kt)("wrapper",(0,i.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"using-code-insertions"},"Using code insertions"),(0,o.kt)("p",null,"VideoAnnotator allows using custom code insertions in these scenarios:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},'Specify lengthy content of an attribute (e.g. "instruction") in a separate HTML file'),(0,o.kt)("li",{parentName:"ul"},"Define custom validators for segment fileds in a JS file"),(0,o.kt)("li",{parentName:"ul"},"Define custom triggers for segment fileds, sections and submit button in a JS file"),(0,o.kt)("li",{parentName:"ul"},"Define custom styles for the VideoAnnotator UI in a CSS file")),(0,o.kt)("p",null,'The inserted code must reside in separate files (called "insertion files") located in ',(0,o.kt)("inlineCode",{parentName:"p"},"insertions")," subdirectory of your annotator config directory."),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("em",{parentName:"li"},"Remember that you can change default config directory path using ",(0,o.kt)("inlineCode",{parentName:"em"},"--directory")," option of ",(0,o.kt)("inlineCode",{parentName:"em"},"video_annotator config")," command"))),(0,o.kt)("hr",null),(0,o.kt)("h2",{id:"html-content-insertion"},"HTML content insertion"),(0,o.kt)("p",null,"An HTML insertion file is specified as a file path that's relative to the assignment config. It can be inserted directly into ",(0,o.kt)("inlineCode",{parentName:"p"},"unit_config.json")," config, or via a token."),(0,o.kt)("h4",{id:"insertion-without-token"},"Insertion without token"),(0,o.kt)("p",null,"Simply set entire value of an attribute to the insertion file's path.\nThis is equivalent to setting value of that attribute to content of the HTML file (except now you don't have to stitch all HTML content into a single unreadable JSON line)."),(0,o.kt)("p",null,"Attributes that support HTML insertions are the same ones that support tokens"),(0,o.kt)("p",null,"Example in ",(0,o.kt)("inlineCode",{parentName:"p"},"unit_config.json"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  ...\n  "instruction": "insertions/some_content.html"\n  ...\n}\n')),(0,o.kt)("h4",{id:"insertion-via-token"},"Insertion via token"),(0,o.kt)("p",null,"Use an extrapolated token as usual, and set that token's value to the insertion file's path.\nUpon extrapolation, value of such token will be automatically replaced with content of the HTML file."),(0,o.kt)("p",null,"Example in ",(0,o.kt)("inlineCode",{parentName:"p"},"token_sets_values_config.json"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "tokens_values": {\n      "some_long_content": "insertions/long_content.html"\n    }\n  }\n]\n')),(0,o.kt)("p",null,"Then embed this token into ",(0,o.kt)("inlineCode",{parentName:"p"},"unit_config.json"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  ...\n  "instruction": "Please see the below instructions: {{some_long_content}}"\n  ...\n}\n')),(0,o.kt)("h2",{id:"js-validator-insertion"},"JS validator insertion"),(0,o.kt)("p",null,"You can define your own custom field validator as a Javascript function, and place it in a special file ",(0,o.kt)("inlineCode",{parentName:"p"},"insertions/custom_validators.js")," inside your annotator config directory.\nWhen a Task is rendered in the browser, your validator function (let's call it ",(0,o.kt)("inlineCode",{parentName:"p"},"myValidator"),") will be imported from this file."),(0,o.kt)("p",null,'In annotator config, the validator function is associated with a field by adding this key-value pair under "validators" attribute:'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'"myValidator": myValidatorArgument\n')),(0,o.kt)("p",null,"In your custom code, each validator function must have the following signature:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Accept 2 required arguments ",(0,o.kt)("inlineCode",{parentName:"li"},"field")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"value"),", and extra arguments as needed",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"field")," is a JS object representing a rendered segment field"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"value")," is provided value of the field (format depends on the field type)"),(0,o.kt)("li",{parentName:"ul"},"Extra arguments will be passed after the ",(0,o.kt)("inlineCode",{parentName:"li"},"value")," argument (they come from the ",(0,o.kt)("inlineCode",{parentName:"li"},"myValidatorArgument")," value you specified in the annotator config under ",(0,o.kt)("inlineCode",{parentName:"li"},'"myValidator"')," key) :",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"If the value is a non-Array (Boolean, String, Number, or non-array Object), it will be passed as-is"),(0,o.kt)("li",{parentName:"ul"},"If the value is an Array, the content of Array will be decostructed and passed as separate positional arguments."))))),(0,o.kt)("li",{parentName:"ul"},"Return value must be either:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"null")," if validation passed successfully"),(0,o.kt)("li",{parentName:"ul"},"String if validation failed",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"This value will be shown to user as an error message underneath the field, and in the error summary block")))))),(0,o.kt)("p",null,"Example in ",(0,o.kt)("inlineCode",{parentName:"p"},"custom_validators.js"),"..."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'// You can import some functions from another file\nimport { someHelper } from "./helpers.js";\n\nexport function fieldContainsWord(field, value, word) {\n  someHelper();\n\n  if (value.includes(word)) {\n    return null;\n  }\n\n  return `Field ${field.name} must contain a word "${word}".`;\n}\n\n// This way you can separate all your validators into separate files, for convenience\nexport { phoneValidatorFunction } from "./phone_validator_code.js";\n')),(0,o.kt)("p",null,"...and its usage in ",(0,o.kt)("inlineCode",{parentName:"p"},"unit_config.json"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  ...\n  "validators": {\n    "required": true,\n    ...\n    "fieldContainsWord": "Mephisto"\n  },\n  ...\n}\n')),(0,o.kt)("h2",{id:"js-trigger-insertion"},"JS trigger insertion"),(0,o.kt)("p",null,"You can define your own custom trigger for a specific segment form element as a Javascript function, and place it in a special file ",(0,o.kt)("inlineCode",{parentName:"p"},"insertions/custom_triggers.js")," inside your annotator config directory.\nWhen a Task is rendered in the browser, your validator function (let's call it ",(0,o.kt)("inlineCode",{parentName:"p"},"myTrigger"),") will be imported from this file.\nNOTE: triggers are called synchronously in the current implementation and your code inside trigger funtion must be synchronous too."),(0,o.kt)("p",null,'In annotator config, the trigger function is associated with an element by adding this key-value pair under "triggers" attribute:'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'"myTrigger": [myTriggerEventType, myTriggerArgument]\n')),(0,o.kt)("p",null,"In your custom code, each trigger function must have the following signature:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Accept 4 required arguments ",(0,o.kt)("inlineCode",{parentName:"li"},"annotatorData"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"updateAnnotatorData"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"element"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"fieldValue"),", ",(0,o.kt)("inlineCode",{parentName:"li"},"segmentFields"),", and extra arguments as needed",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"annotatorData")," is a React state with annotator data (",(0,o.kt)("inlineCode",{parentName:"li"},"{<fieldName>: <fieldValue>, ...}"),")",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"This allows to lookup values of any segment field by its ",(0,o.kt)("inlineCode",{parentName:"li"},'"name"')," attribute"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"updateAnnotatorData")," is a callback that sets value of any segment field in the React state",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"This allows to change values of any segment field by its ",(0,o.kt)("inlineCode",{parentName:"li"},'"name"')," attribute, e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},'updateAnnotatorData("name_first", "Austin")'),". Note that you will need change HTML-field value as well."))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"element"),' is the segment form object that fired the trigger (i.e. "field", "section" or "submit button" object defined in annotator config)'),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"fieldValue")," is the value of an element that fired the trigger, if it's a segment field (otherwise it's null)"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"segmentFields")," is an object containing all segment fields as defined in 'unit_config.json' (otherwise it's null)"),(0,o.kt)("li",{parentName:"ul"},"Extra arguments will be passed after the ",(0,o.kt)("inlineCode",{parentName:"li"},"fieldValue")," argument (they come from the ",(0,o.kt)("inlineCode",{parentName:"li"},"myTriggerArgument")," value you specified in the annotator config under ",(0,o.kt)("inlineCode",{parentName:"li"},'"myTrigger"')," key) :",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"If the value is a non-Array (Boolean, String, Number, or non-array Object), it will be passed as-is"),(0,o.kt)("li",{parentName:"ul"},"If the value is an Array, the content of Array will be decostructed and passed as separate positional arguments.")))))),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"myTriggerEventType")," parameter can take one of the following values, depending on the type of trigger element:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"non-field elements:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onClick"')))),(0,o.kt)("li",{parentName:"ul"},'"field" element:',(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"checkbox")," field type:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onChange"')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onClick"')," (triggered from any part of the entire field, not just the buttons)"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"file")," field type:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onChange"')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onBlur"')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onFocus"')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onClick"')))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"input")," field type:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onChange"')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onBlur"')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onFocus"')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onClick"')))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"radio")," field type:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onChange"')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onClick"')," (triggered from any part of the entire field, not just the buttons)"))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"select")," field type:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onChange"')))),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"textarea")," field type:",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onChange"')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onBlur"')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onFocus"')),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},'"onClick"'))))))),(0,o.kt)("p",null,"Example in ",(0,o.kt)("inlineCode",{parentName:"p"},"custom_triggers.js"),"..."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'export function onFocusDescription(\n  annotatorData, // React state for the entire annotator\n  updateAnnotatorData, // callback to set the React state\n  element, // "field", "section", or "submit button" element that invoked this trigger\n  fieldValue, // (optional) current field value, if the `element` is a segment field\n  segmentFields, // (optional) Object containing all segment fields as defined in \'unit_config.json\'\n  sectionName // Argument for this trigger (taken from annotator config)\n) {\n  alert(`${argumentFromConfig} description was focused!`);\n}\n')),(0,o.kt)("p",null,"...and its usage in ",(0,o.kt)("inlineCode",{parentName:"p"},"unit_config.json"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  ...,\n  "triggers": {\n    "onChange": ["onChangeName", [true, {"prefix": "_"}, 100]]\n  }\n  ...\n  "triggers": {\n    "onClick": ["onFocusDescription", "\'Description\'"]\n  }\n  ...\n}\n')),(0,o.kt)("h4",{id:"js-trigger-helpers"},"JS trigger helpers"),(0,o.kt)("p",null,"During development of your annotator config, you can use a few available helper functions."),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"p"},"validateFieldValue")," - checks whether you're assigning a valid value to a field\n(in case you want to change them programmatically)."),(0,o.kt)("p",{parentName:"li"},"  Example of use:")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Add ",(0,o.kt)("inlineCode",{parentName:"p"},"mephisto-addons")," in webpack config"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},'resolve: {\n  alias: {\n    ...\n    "mephisto-addons": path.resolve(\n      __dirname,\n      "<relativePath>/packages/mephisto-addons"\n    ),\n  },\n}\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Add import"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},'import { validateFieldValue } from "mephisto-addons";\n'))),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("p",{parentName:"li"},"Validate a value before assigning it to segment field"),(0,o.kt)("pre",{parentName:"li"},(0,o.kt)("code",{parentName:"pre",className:"language-js"},'const valueIsValid = validateFieldValue(segmentFields.languageRadioSelector, {"en": true, "fr": false}, true);\n')))),(0,o.kt)("h2",{id:"css-styles-insertions"},"CSS styles insertions"),(0,o.kt)("p",null,"To customize UI appearance, and separate CSS styles from your HTML insertions,\nyou can create multiple CSS files in the ",(0,o.kt)("inlineCode",{parentName:"p"},"insertions")," directory.\nThe only naming requirement is that their filenames should end with ",(0,o.kt)("inlineCode",{parentName:"p"},".css")," extension.\nThese CSS files will be automatically included in VideoAnnotator UI via webpack build."),(0,o.kt)("p",null,"You can use CSS insertions to customize not only your HTML insertions pieces,\nbut also the standard Bootstrap form components themselves. There's two ways to do so:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"override existing styles (use CSS selectors for existing classes, names, ids, etc)"),(0,o.kt)("li",{parentName:"ul"},"add your own styles, and link them to ids and classes of form components (via their ",(0,o.kt)("inlineCode",{parentName:"li"},"id")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"classes")," config attributes - see ",(0,o.kt)("a",{parentName:"li",href:"/docs/guides/how_to_use/video_annotator/configuration/config_files/"},"Config files reference"),")")))}c.isMDXComponent=!0}}]);