"use strict";(self.webpackChunkweb=self.webpackChunkweb||[]).push([[207],{5110:function(t,e,n){n.d(e,{Zo:function(){return u},kt:function(){return g}});var a=n(9703);function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function i(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function r(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?i(Object(n),!0).forEach((function(e){o(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e){if(null==t)return{};var n,a,o=function(t,e){if(null==t)return{};var n,a,o={},i=Object.keys(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||(o[n]=t[n]);return o}(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(o[n]=t[n])}return o}var d=a.createContext({}),l=function(t){var e=a.useContext(d),n=e;return t&&(n="function"==typeof t?t(e):r(r({},e),t)),n},u=function(t){var e=l(t.components);return a.createElement(d.Provider,{value:e},t.children)},c={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},p=a.forwardRef((function(t,e){var n=t.components,o=t.mdxType,i=t.originalType,d=t.parentName,u=s(t,["components","mdxType","originalType","parentName"]),p=l(n),g=o,h=p["".concat(d,".").concat(g)]||p[g]||c[g]||i;return n?a.createElement(h,r(r({ref:e},u),{},{components:n})):a.createElement(h,r({ref:e},u))}));function g(t,e){var n=arguments,o=e&&e.mdxType;if("string"==typeof t||o){var i=n.length,r=new Array(i);r[0]=p;var s={};for(var d in e)hasOwnProperty.call(e,d)&&(s[d]=e[d]);s.originalType=t,s.mdxType="string"==typeof t?t:o,r[1]=s;for(var l=2;l<i;l++)r[l]=n[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},2775:function(t,e,n){n.r(e),n.d(e,{contentTitle:function(){return d},default:function(){return p},frontMatter:function(){return s},metadata:function(){return l},toc:function(){return u}});var a=n(2922),o=n(9230),i=(n(9703),n(5110)),r=["components"],s={sidebar_position:3},d="Introducing worker controls",l={unversionedId:"guides/tutorials/worker_controls",id:"guides/tutorials/worker_controls",isDocsHomePage:!1,title:"Introducing worker controls",description:"Now that you have a task to show workers, in order to get quality data you'll want to include a mix of automated and manual reviewing. This guide introduces onboarding, which is a good opportunity to provide workers with a simple test to ensure they read and understand task instructions. A more in-depth guide into their use can be found here. We expect familiarity with React's core concepts to understand the frontend part of this tutorial.",source:"@site/docs/guides/tutorials/worker_controls.md",sourceDirName:"guides/tutorials",slug:"/guides/tutorials/worker_controls",permalink:"/docs/guides/tutorials/worker_controls",editUrl:"https://github.com/facebookresearch/Mephisto/tree/main/docs/web/docs/guides/tutorials/worker_controls.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"guides",previous:{title:"Working on a custom task",permalink:"/docs/guides/tutorials/custom_react"},next:{title:"Developing a workflow",permalink:"/docs/guides/tutorials/workflows"}},u=[{value:"1. Launching with onboarding",id:"1-launching-with-onboarding",children:[],level:2},{value:"2. Customizing the onboarding",id:"2-customizing-the-onboarding",children:[{value:"2.1 Onboarding Initialization Data",id:"21-onboarding-initialization-data",children:[],level:3},{value:"2.2 Onboarding View",id:"22-onboarding-view",children:[],level:3},{value:"2.3 Onboarding validation",id:"23-onboarding-validation",children:[],level:3},{value:"2.4 Testing",id:"24-testing",children:[],level:3}],level:2},{value:"3. Reviews with onboarding",id:"3-reviews-with-onboarding",children:[],level:2}],c={toc:u};function p(t){var e=t.components,s=(0,o.Z)(t,r);return(0,i.kt)("wrapper",(0,a.Z)({},c,s,{components:e,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"introducing-worker-controls"},"Introducing worker controls"),(0,i.kt)("p",null,"Now that you have a task to show workers, in order to get quality data you'll want to include a mix of automated and manual reviewing. This guide introduces onboarding, which is a good opportunity to provide workers with a simple test to ensure they read and understand task instructions. A more in-depth guide into their use can be found ",(0,i.kt)("a",{parentName:"p",href:"../how_to_use/worker_quality/using_onboarding/"},"here"),". We expect familiarity with React's core concepts to understand the frontend part of this tutorial."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Note:")," Generally this flow should be combined with other methods for ensuring quality, such as ",(0,i.kt)("a",{parentName:"p",href:"../how_to_use/worker_quality/using_screen_units/"},"screening units")," or ",(0,i.kt)("a",{parentName:"p",href:"../how_to_use/worker_quality/using_golds/"},"gold units"),"."),(0,i.kt)("h2",{id:"1-launching-with-onboarding"},"1. Launching with onboarding"),(0,i.kt)("p",null,"Let's extend again from the static react task example, but we'll want to move it to it's own workspace. From within the main Mephisto directory:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"cp -r examples/static_react_task/ tmp/onboarding_tutorial/\ncd tmp/onboarding_tutorial/\n")),(0,i.kt)("p",null,"The key for using onboarding is the ",(0,i.kt)("inlineCode",{parentName:"p"},"onboarding_qualification"),", as we can see in ",(0,i.kt)("inlineCode",{parentName:"p"},"onboarding_example.yaml"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-yaml"},"# hydra_configs/conf/onboarding_example.yaml\n@package _global_\ndefaults:\n  - /mephisto/blueprint: static_react_task\n  - /mephisto/architect: local\n  - /mephisto/provider: mock\nmephisto:\n  blueprint:\n    ...\n    onboarding_qualification: test-react-static-qualification # This is the key!\n  task:\n    ...\n    task_name: onboarding-tutorial-iterating # Add a custom task name to group the results\n")),(0,i.kt)("p",null,"When Mephisto sees the ",(0,i.kt)("inlineCode",{parentName:"p"},"mephisto.blueprint.onboarding_qualification")," argument, it adds a step to the task that requires workers pass onboarding in order to move on to the main task. Why don't we see it in action? You can launch the onboarding version of this task with ",(0,i.kt)("inlineCode",{parentName:"p"},"python run_task.py conf=onboarding_example"),". Once launched, you can follow through to ",(0,i.kt)("a",{parentName:"p",href:"localhost:3000/?worker_id=x&assignment_id=1"},(0,i.kt)("inlineCode",{parentName:"a"},"localhost:3000/?worker_id=x&assignment_id=1")),"."),(0,i.kt)("p",null,"You should be greeted with a panel claiming it is the onboarding task, suggesting that you click a button to move to the main task. Clicking this button puts you into the example static react task. It's not a very informative task as is, so let's add some details into it! Shut down the server and we'll get back to it"),(0,i.kt)("h2",{id:"2-customizing-the-onboarding"},"2. Customizing the onboarding"),(0,i.kt)("p",null,"Onboarding units have three primary components, the initialization data, the view component, and the validation function. Lets change each of these in turn:"),(0,i.kt)("h3",{id:"21-onboarding-initialization-data"},"2.1 Onboarding Initialization Data"),(0,i.kt)("p",null,"In the same way that we used ",(0,i.kt)("inlineCode",{parentName:"p"},"SharedStaticTaskState.static_task_data")," to initialize the ",(0,i.kt)("inlineCode",{parentName:"p"},"initialTaskData")," that is available during a main task, there's a way to initialize that field specifically for onboarding tasks. Let's initialize it with a few test good and bad phrases:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"shared_state = SharedStaticTaskState(\n    onboarding_data={\n        'good': ['Today was good', 'I like ice cream'], \n        'bad': ['Dirt tastes bad', 'Bad news'],\n    },\n    ...\n)\n")),(0,i.kt)("p",null,"Adding the ",(0,i.kt)("inlineCode",{parentName:"p"},"onboarding_data")," field to your ",(0,i.kt)("inlineCode",{parentName:"p"},"SharedTaskState")," is all that needs to be done."),(0,i.kt)("h3",{id:"22-onboarding-view"},"2.2 Onboarding View"),(0,i.kt)("p",null,'Now with this data, we can create an onboarding task on the frontend. We\'ll update the onboarding component to define what we mean by "good text" and "bad text", and then give the worker a few examples to label and submit. '),(0,i.kt)("p",null,"First let's go to ",(0,i.kt)("inlineCode",{parentName:"p"},"app.jsx")," and pass the task data along to our onboarding component"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// webapp/src/app.jsx\n...\n  if (isOnboarding) {\n    return <OnboardingComponent onboardingData={initialTaskData} onSubmit={handleSubmit} />;\n  }\n...\n")),(0,i.kt)("p",null,"And now we can go to ",(0,i.kt)("inlineCode",{parentName:"p"},"core_components.jsx")," and put some new components here:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'// webapp/src/components/core_components.jsx\n// Component for displaying an individual sentence and picking the response\nfunction SentenceDisplay({idx, currSelected, displayText, onChangeSelected}) {\n  return (\n    <>\n      <h3>{displayText}</h3>\n      <div className="field is-grouped">\n        <div className="control">\n          <button\n            className="button is-success is-large"\n            disabled={currSelected == "good"}\n            onClick={() => onChangeSelected({idx, rating: "good" })}\n          >\n            Mark as Good\n          </button>\n        </div>\n        <div className="control">\n          <button\n            className="button is-danger is-large"\n            disabled={currSelected == "bad"}\n            onClick={() => onChangeSelected({idx, rating: "bad" })}\n          >\n            Mark as Bad\n          </button>\n        </div>\n      </div>\n    <br/>\n    </>\n  );\n}\n\n// Replace the existing OnboardingComponent with this one\nfunction OnboardingComponent({ onboardingData, onSubmit }) {\n  // Grab the list of good and bad phrases and shuffle them\n  const [textList, _setTextList] = React.useState(\n    [...onboardingData[\'good\'], ...onboardingData[\'bad\']]\n      .map(text => ({ text, rand: Math.random() }))\n      .sort((a, b) => a.rand - b.rand)\n      .map(({ text }) => text)\n  );\n  // Create a ratings object to hold the annotations\n  const [ratings, updateRatings] = React.useReducer(\n    (oldRatings, {idx, rating}) => {\n      return oldRatings.map((oldRating, i) =>\n        i == idx ? rating : oldRating\n      );\n    },\n    (textList.map(() => null))\n  );\n  // Function to zip the text list to the ratings\n  function zipResults() {\n    return Object.fromEntries(textList.map((t, idx) => [t, ratings[idx]]));\n  }\n  return (\n    <div>\n      <Directions>\n        In this task you\'ll be presented with a sentence, and need to provide a rating of either "Good" or "Bad". For our definition, all sentences are "good" by default, unless they contain the word "bad". Complete the following 4 examples.\n      </Directions>\n      <div className="container">\n        {\n          // Construct an input for each question\n          textList.map((text, idx) => <SentenceDisplay\n            key={\'sentence-\'+idx}\n            idx={idx}\n            displayText={text}\n            currSelected={ratings[idx]}\n            onChangeSelected={updateRatings}\n          />)\n        }\n      <button\n        className="button is-link"\n        disabled={ratings.some((val) => val === null)}\n        onClick={() => onSubmit({ ratings: zipResults()})}\n      >\n        Submit Answers\n      </button>\n      </div>\n    </div>\n  );\n}\n')),(0,i.kt)("p",null,"With this, let's launch again with ",(0,i.kt)("inlineCode",{parentName:"p"},"python run_task.py conf=onboarding_example"),". Once launched, you can follow through to ",(0,i.kt)("a",{parentName:"p",href:"localhost:3000/?worker_id=y&assignment_id=1"},(0,i.kt)("inlineCode",{parentName:"a"},"localhost:3000/?worker_id=y&assignment_id=1")),". ",(0,i.kt)("strong",{parentName:"p"},"Note")," that now we're accessing as worker ",(0,i.kt)("inlineCode",{parentName:"p"},"y"),". We do this because worker ",(0,i.kt)("inlineCode",{parentName:"p"},"x")," has already completed onboarding for our task name, and so they'd skip it! Onboarding is only surfaced the ",(0,i.kt)("em",{parentName:"p"},"first time")," a worker completes a task by a given ",(0,i.kt)("inlineCode",{parentName:"p"},"onboarding_qualification"),"."),(0,i.kt)("p",null,(0,i.kt)("img",{src:n(2473).Z})),(0,i.kt)("p",null,"This is much more relevant to the core task! Now that we can collect an onboarding, let's move on to validating the content to ensure workers understood the task."),(0,i.kt)("h3",{id:"23-onboarding-validation"},"2.3 Onboarding validation"),(0,i.kt)("p",null,"The crux of onboarding validation occurs in the function we provide to ",(0,i.kt)("inlineCode",{parentName:"p"},"validate_onboarding"),". In this case, it was:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"    def onboarding_always_valid(onboarding_data):\n        return True\n")),(0,i.kt)("p",null,"Well, this isn't going to be doing any validation just yet. We'll have to write a new validation function. To do this, let's see what we would have received from ",(0,i.kt)("inlineCode",{parentName:"p"},"onboarding_data"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"{\n  'inputs': {\n    'good': ['Today was good', 'I like ice cream'], \n    'bad': ['Dirt tastes bad', 'Bad news']\n  },\n  'outputs': {\n    'ratings': {\n      'Dirt tastes bad': 'good', \n      'Today was good': 'good', \n      'I like ice cream': 'bad', \n      'Bad news': 'bad'\n    }\n  }, \n  'times': {'task_start': 1646947187.8276632, 'task_end': 1646947350.760277}\n}\n")),(0,i.kt)("p",null,"From here we can check the inputs and outputs to generate a new onboarding test:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"def onboarding_labeled_correctly(onboarding_data):\n    for text, rating in onboarding_data['outputs']['ratings'].items():\n        if text not in onboarding_data['inputs'][rating]:\n            return False\n    return True\n\n...\n\nshared_state = SharedStaticTaskState(\n  ...\n  validate_onboarding=onboarding_labeled_correctly,\n)\n")),(0,i.kt)("p",null,"And that's it! Let's move forward to test that this works."),(0,i.kt)("h3",{id:"24-testing"},"2.4 Testing"),(0,i.kt)("p",null,"Let's launch again with ",(0,i.kt)("inlineCode",{parentName:"p"},"python run_task.py conf=onboarding_example"),". Once launched, we should open a tab for ",(0,i.kt)("a",{parentName:"p",href:"localhost:3000/?worker_id=a&assignment_id=1"},(0,i.kt)("inlineCode",{parentName:"a"},"worker a"))," and ",(0,i.kt)("a",{parentName:"p",href:"localhost:3000/?worker_id=b&assignment_id=1"},(0,i.kt)("inlineCode",{parentName:"a"},"worker b")),". Complete the onboarding correctly as one worker, and assert that you're able to make it through to the task! Complete it incorrectly as the other, and note that you are not qualified to work on the task. With this, you have a functioning basic onboarding task!"),(0,i.kt)("h2",{id:"3-reviews-with-onboarding"},"3. Reviews with onboarding"),(0,i.kt)("p",null,"Mephisto doesn't currently provide out-of-the-box tooling for manually reviewing onboarding tasks, as these should be handled by your own tools. It is certainly possible to query these agents directly to see them though, as you may want to examine what workers are putting in during your onboarding"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-python"},"from mephisto.abstractions.databases.local_database import LocalMephistoDB\ndb = LocalMephistoDB()\ntask = db.find_tasks(task_name='onboarding-tutorial-iterating')[0]\nonboarding_agents = db.find_onboarding_agents(task_id=task.db_id)\nprint(onboarding_agents[-1].state.get_data())\n# {'inputs': {'good': ['Today was good', 'I like ice cream'], 'bad': ['Dirt tastes bad', 'Bad news']}, 'outputs': {'ratings': {'Today was good': 'good', 'I like ice cream': 'good', 'Bad news': 'bad', 'Dirt tastes bad': 'bad'}}, 'times': {'task_start': 1646948706.989197, 'task_end': 1646948712.4583411}}\n")),(0,i.kt)("p",null,"Retrieving the onboarding unit associated with a specific task unit isn't yet supported, see ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/facebookresearch/Mephisto/issues/600"},"#600")," if you're interested in potentially helping build this!"))}p.isMDXComponent=!0},2473:function(t,e,n){e.Z=n.p+"assets/images/tutorial_onboarding_new_interface-5edb8c3c152f1fb67278626819c2b0d2.png"},2922:function(t,e,n){function a(){return a=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},a.apply(this,arguments)}n.d(e,{Z:function(){return a}})},9230:function(t,e,n){function a(t,e){if(null==t)return{};var n,a,o={},i=Object.keys(t);for(a=0;a<i.length;a++)n=i[a],e.indexOf(n)>=0||(o[n]=t[n]);return o}n.d(e,{Z:function(){return a}})}}]);